var hexcase=0;
function hex_md5(b){return rstr2hex(rstr_md5(str2rstr_utf8(b)))
}function hex_hmac_md5(d,c){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(d),str2rstr_utf8(c)))
}function md5_vm_test(){return hex_md5("abc").toLowerCase()=="900150983cd24fb0d6963f7d28e17f72"
}function rstr_md5(b){return binl2rstr(binl_md5(rstr2binl(b),b.length*8))
}function rstr_hmac_md5(n,k){var l=rstr2binl(n);
if(l.length>16){l=binl_md5(l,n.length*8)
}var i=Array(16),m=Array(16);
for(var h=0;
h<16;
h++){i[h]=l[h]^909522486;
m[h]=l[h]^1549556828
}var j=binl_md5(i.concat(rstr2binl(k)),512+k.length*8);
return binl2rstr(binl_md5(m.concat(j),512+128))
}function rstr2hex(l){try{hexcase
}catch(i){hexcase=0
}var j=hexcase?"0123456789ABCDEF":"0123456789abcdef";
var e="";
var h;
for(var k=0;
k<l.length;
k++){h=l.charCodeAt(k);
e+=j.charAt((h>>>4)&15)+j.charAt(h&15)
}return e
}function str2rstr_utf8(j){var f="";
var i=-1;
var g,h;
while(++i<j.length){g=j.charCodeAt(i);
h=i+1<j.length?j.charCodeAt(i+1):0;
if(55296<=g&&g<=56319&&56320<=h&&h<=57343){g=65536+((g&1023)<<10)+(h&1023);
i++
}if(g<=127){f+=String.fromCharCode(g)
}else{if(g<=2047){f+=String.fromCharCode(192|((g>>>6)&31),128|(g&63))
}else{if(g<=65535){f+=String.fromCharCode(224|((g>>>12)&15),128|((g>>>6)&63),128|(g&63))
}else{if(g<=2097151){f+=String.fromCharCode(240|((g>>>18)&7),128|((g>>>12)&63),128|((g>>>6)&63),128|(g&63))
}}}}}return f
}function rstr2binl(d){var e=Array(d.length>>2);
for(var f=0;
f<e.length;
f++){e[f]=0
}for(var f=0;
f<d.length*8;
f+=8){e[f>>5]|=(d.charCodeAt(f/8)&255)<<(f%32)
}return e
}function binl2rstr(d){var e="";
for(var f=0;
f<d.length*32;
f+=8){e+=String.fromCharCode((d[f>>5]>>>(f%32))&255)
}return e
}function binl_md5(a,q){a[q>>5]|=128<<((q)%32);
a[(((q+64)>>>9)<<4)+14]=q;
var b=1732584193;
var c=-271733879;
var d=-1732584194;
var i=271733878;
for(var t=0;
t<a.length;
t+=16){var r=b;
var s=c;
var u=d;
var v=i;
b=md5_ff(b,c,d,i,a[t+0],7,-680876936);
i=md5_ff(i,b,c,d,a[t+1],12,-389564586);
d=md5_ff(d,i,b,c,a[t+2],17,606105819);
c=md5_ff(c,d,i,b,a[t+3],22,-1044525330);
b=md5_ff(b,c,d,i,a[t+4],7,-176418897);
i=md5_ff(i,b,c,d,a[t+5],12,1200080426);
d=md5_ff(d,i,b,c,a[t+6],17,-1473231341);
c=md5_ff(c,d,i,b,a[t+7],22,-45705983);
b=md5_ff(b,c,d,i,a[t+8],7,1770035416);
i=md5_ff(i,b,c,d,a[t+9],12,-1958414417);
d=md5_ff(d,i,b,c,a[t+10],17,-42063);
c=md5_ff(c,d,i,b,a[t+11],22,-1990404162);
b=md5_ff(b,c,d,i,a[t+12],7,1804603682);
i=md5_ff(i,b,c,d,a[t+13],12,-40341101);
d=md5_ff(d,i,b,c,a[t+14],17,-1502002290);
c=md5_ff(c,d,i,b,a[t+15],22,1236535329);
b=md5_gg(b,c,d,i,a[t+1],5,-165796510);
i=md5_gg(i,b,c,d,a[t+6],9,-1069501632);
d=md5_gg(d,i,b,c,a[t+11],14,643717713);
c=md5_gg(c,d,i,b,a[t+0],20,-373897302);
b=md5_gg(b,c,d,i,a[t+5],5,-701558691);
i=md5_gg(i,b,c,d,a[t+10],9,38016083);
d=md5_gg(d,i,b,c,a[t+15],14,-660478335);
c=md5_gg(c,d,i,b,a[t+4],20,-405537848);
b=md5_gg(b,c,d,i,a[t+9],5,568446438);
i=md5_gg(i,b,c,d,a[t+14],9,-1019803690);
d=md5_gg(d,i,b,c,a[t+3],14,-187363961);
c=md5_gg(c,d,i,b,a[t+8],20,1163531501);
b=md5_gg(b,c,d,i,a[t+13],5,-1444681467);
i=md5_gg(i,b,c,d,a[t+2],9,-51403784);
d=md5_gg(d,i,b,c,a[t+7],14,1735328473);
c=md5_gg(c,d,i,b,a[t+12],20,-1926607734);
b=md5_hh(b,c,d,i,a[t+5],4,-378558);
i=md5_hh(i,b,c,d,a[t+8],11,-2022574463);
d=md5_hh(d,i,b,c,a[t+11],16,1839030562);
c=md5_hh(c,d,i,b,a[t+14],23,-35309556);
b=md5_hh(b,c,d,i,a[t+1],4,-1530992060);
i=md5_hh(i,b,c,d,a[t+4],11,1272893353);
d=md5_hh(d,i,b,c,a[t+7],16,-155497632);
c=md5_hh(c,d,i,b,a[t+10],23,-1094730640);
b=md5_hh(b,c,d,i,a[t+13],4,681279174);
i=md5_hh(i,b,c,d,a[t+0],11,-358537222);
d=md5_hh(d,i,b,c,a[t+3],16,-722521979);
c=md5_hh(c,d,i,b,a[t+6],23,76029189);
b=md5_hh(b,c,d,i,a[t+9],4,-640364487);
i=md5_hh(i,b,c,d,a[t+12],11,-421815835);
d=md5_hh(d,i,b,c,a[t+15],16,530742520);
c=md5_hh(c,d,i,b,a[t+2],23,-995338651);
b=md5_ii(b,c,d,i,a[t+0],6,-198630844);
i=md5_ii(i,b,c,d,a[t+7],10,1126891415);
d=md5_ii(d,i,b,c,a[t+14],15,-1416354905);
c=md5_ii(c,d,i,b,a[t+5],21,-57434055);
b=md5_ii(b,c,d,i,a[t+12],6,1700485571);
i=md5_ii(i,b,c,d,a[t+3],10,-1894986606);
d=md5_ii(d,i,b,c,a[t+10],15,-1051523);
c=md5_ii(c,d,i,b,a[t+1],21,-2054922799);
b=md5_ii(b,c,d,i,a[t+8],6,1873313359);
i=md5_ii(i,b,c,d,a[t+15],10,-30611744);
d=md5_ii(d,i,b,c,a[t+6],15,-1560198380);
c=md5_ii(c,d,i,b,a[t+13],21,1309151649);
b=md5_ii(b,c,d,i,a[t+4],6,-145523070);
i=md5_ii(i,b,c,d,a[t+11],10,-1120210379);
d=md5_ii(d,i,b,c,a[t+2],15,718787259);
c=md5_ii(c,d,i,b,a[t+9],21,-343485551);
b=safe_add(b,r);
c=safe_add(c,s);
d=safe_add(d,u);
i=safe_add(i,v)
}return Array(b,c,d,i)
}function md5_cmn(a,j,k,l,b,i){return safe_add(bit_rol(safe_add(safe_add(j,a),safe_add(l,i)),b),k)
}function md5_ff(l,m,a,b,n,c,d){return md5_cmn((m&a)|((~m)&b),l,m,n,c,d)
}function md5_gg(l,m,a,b,n,c,d){return md5_cmn((m&b)|(a&(~b)),l,m,n,c,d)
}function md5_hh(l,m,a,b,n,c,d){return md5_cmn(m^a^b,l,m,n,c,d)
}function md5_ii(l,m,a,b,n,c,d){return md5_cmn(a^(m|(~b)),l,m,n,c,d)
}function safe_add(f,g){var h=(f&65535)+(g&65535);
var e=(f>>16)+(g>>16)+(h>>16);
return(e<<16)|(h&65535)
}function bit_rol(d,c){return(d<<c)|(d>>>(32-c))
};
function SparqlClient(c,b){var a=new HTTP_Client();
this.setAuthToken=function(d){a.setAuthToken(d)
};
this.select=function(f,d,e){a.get(c,{query:encodeURIComponent(f)},null,"application/sparql-results+json",{200:function(g){if(d){d(JSON.parse(g).results.bindings)
}},"default":function(g){if(e){e(g)
}}})
};
this.ask=function(f,d,e){a.get(c,{query:encodeURIComponent(f)},null,"application/sparql-results+json;charset=UTF-8",{200:function(h){var g=JSON.parse(h)["boolean"];
if(d){d(String(g)=="true"?true:false)
}},"default":function(g){if(e){e(g)
}}})
};
this.update=function(f,d,e){a.post(b,null,f,"application/sparql-update;charset=UTF-8",{200:function(){if(d){d()
}},204:function(){if(d){d()
}},"default":function(g){if(e){e(g)
}}})
};
this.getSelectEndpoint=function(){return c
};
this.setSelectEndpoint=function(d){c=d
};
this.getUpdateEndpoint=function(){return b
};
this.setUpdateEndpoint=function(d){b=d
}
}function HTTP_Client(){var d=undefined;
function c(){var e=null;
if(window.XMLHttpRequest){e=new XMLHttpRequest()
}else{if(window.ActiveXObject){e=new ActiveXObject("Microsoft.XMLHTTP")
}else{throw"request object can not be created"
}}return e
}function b(f){if(f==null||f.length==0){return""
}var e="?";
if(d!=undefined){e+="auth_token="+d+"&"
}for(prop in f){e+=prop+"="+f[prop]+"&"
}return e.substring(0,e.length-1)
}function a(l,k,g,j,e,i){e=e||"application/json;charset=UTF-8";
var f=k+b(g);
var h=c();
h.onreadystatechange=function(){if(h.readyState==4){if(i.hasOwnProperty(h.status)){i[h.status](h.responseText,h)
}else{if(i.hasOwnProperty("default")){i["default"](h.responseText,h)
}else{throw"Status:"+h.status+",Text:"+h.responseText
}}}};
h.open(l,f,true);
if(l=="PUT"||l=="POST"){h.setRequestHeader("Content-Type",e)
}if(l=="GET"){h.setRequestHeader("Accept",e)
}h.send(j)
}this.get=function(i,f,h,e,g){a("GET",i,f,h,e,g)
};
this.put=function(i,f,h,e,g){a("PUT",i,f,h,e,g)
};
this.post=function(i,f,h,e,g){a("POST",i,f,h,e,g)
};
this._delete=function(i,f,h,e,g){a("DELETE",i,f,h,e,g)
};
this.setAuthToken=function(e){d=e
}
};
function SKOSClient(f,c){var e={LANGUAGE:"en",DEBUG:false,LABEL_GRAPH:"http://purl.org/dc/terms/title",LABEL_SCHEME:"http://www.w3.org/2000/01/rdf-schema#label"};
$.extend(e,c);
var a=this;
var d={SKOS:"http://www.w3.org/2004/02/skos/core#",RDF:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",RDFS:"http://www.w3.org/2000/01/rdf-schema#",DC_TERMS:"http://purl.org/dc/terms/",SKOSJS:"http://tkurz.github.com/skosjs/ns/2012/03/"};
this.setLanguage=function(g){e.LANGUAGE=g
};
this.exists={uri:function(h,g,j){var i="ASK { <"+h+"> ?a ?b }";
if(e.DEBUG){console.debug(i)
}f.ask(i,g,j)
},graph:function(j,g,i){var h="ASK { {GRAPH <"+j+"> { <"+j+"> <"+d.RDF+"type><"+d.SKOSJS+"Project> }}UNION {GRAPH <"+j+"> { ?a <"+d.RDF+"type><"+d.SKOS+"Concept> }}}";
if(e.DEBUG){console.debug(h)
}f.ask(h,function(k){if(!k){i()
}else{g()
}},i)
}};
this.create={graph:function(h,j,g,i){a.exists.uri(h,function(l){if(l){i();
return
}var m=b();
var k="CREATE GRAPH<"+h+">";
if(e.DEBUG){console.debug(k)
}f.update(k,function(){var n="INSERT DATA {GRAPH <"+h+"> {<"+h+"> <"+e.LABEL_GRAPH+'>"'+j+'";<'+d.RDF+"type><"+d.SKOSJS+"Project>;<"+d.DC_TERMS+'created>"'+m+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>;<'+d.DC_TERMS+'modified>"'+m+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>. }}';
if(e.DEBUG){console.debug(n)
}f.update(n,g,i)
},i)
},i)
},scheme:function(j,h,k,g,i){a.exists.uri(h,function(m){if(m){i();
return
}var o=b();
var n=e.LANGUAGE=="none"?"":"@"+e.LANGUAGE;
var l="INSERT DATA {GRAPH <"+j+"> {<"+h+"> <"+e.LABEL_SCHEME+'>"'+k+'"'+n+";<"+d.RDF+"type><"+d.SKOS+"ConceptScheme>;<"+d.DC_TERMS+'created>"'+o+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>;<'+d.DC_TERMS+'modified>"'+o+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>. }}';
if(e.DEBUG){console.debug(l)
}f.update(l,g,i)
},i)
},top_concept:function(k,i,h,l,g,j){a.exists.uri(h,function(n){if(n){j();
return
}var p=b();
var o=e.LANGUAGE=="none"?"":"@"+e.LANGUAGE;
var m="INSERT DATA {GRAPH <"+k+"> {<"+h+"> <"+d.SKOS+'prefLabel>"'+l+'"'+o+";<"+d.RDF+"type><"+d.SKOS+"Concept>;<"+d.DC_TERMS+'created>"'+p+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>;<'+d.DC_TERMS+'modified>"'+p+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>.<'+i+"><"+d.SKOS+"hasTopConcept><"+h+">.<"+h+"><"+d.SKOS+"topConceptOf><"+i+">.}}";
if(e.DEBUG){console.log(m)
}f.update(m,g,j)
},j)
},concept:function(k,i,h,l,g,j){a.exists.uri(h,function(n){if(n){j();
return
}var p=b();
var o=e.LANGUAGE=="none"?"":"@"+e.LANGUAGE;
var m="WITH <"+k+"> INSERT {<"+h+"> <"+d.SKOS+'prefLabel>"'+l+'"'+o+";<"+d.RDF+"type><"+d.SKOS+"Concept>;<"+d.DC_TERMS+'created>"'+p+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>;<'+d.DC_TERMS+'modified>"'+p+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>;<'+d.SKOS+"broader><"+i+">.<"+i+"><"+d.SKOS+"narrower><"+h+">.} WHERE {}";
if(e.DEBUG){console.log(m)
}f.update(m,g,j)
},j)
}};
this.set={value:function(n,g,m,l,h,o,i){var j=b();
h=h&&h!="none"?"@"+h:"";
var k="WITH <"+n+"> DELETE {<"+g+"><"+d.DC_TERMS+"modified>?_mod} INSERT {<"+g+"> <"+m+'>"'+l+'"'+h+";<"+d.DC_TERMS+'modified>"'+j+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>} WHERE {OPTIONAL {<'+g+"><"+d.DC_TERMS+"modified>?_mod}}";
if(e.DEBUG){console.debug(k)
}f.update(k,o,i)
},uri:function(m,h,l,k,g,j){var n=b();
var i="WITH <"+m+"> DELETE {<"+h+"><"+d.DC_TERMS+"modified>?_mod} INSERT {<"+h+"> <"+l+"><"+k+">;<"+d.DC_TERMS+'modified>"'+n+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>} WHERE {OPTIONAL {<'+h+"><"+d.DC_TERMS+"modified>?_mod}}";
if(e.DEBUG){console.debug(i)
}f.update(i,g,j)
},values:function(n,j,m,g,l){var o=b();
var k="WITH <"+n+"> DELETE {<"+j+"><"+d.DC_TERMS+"modified>?_mod}  INSERT {<"+j+">";
for(var h=0;
h<m.length;
h++){switch(m[h].type){case"uri":k+="<"+m[h].property+"><"+m[h].value+">";
break;
case"string":m[h].language=m[h].language?"@"+m[h].language:"";
k+="<"+m[h].property+'>"'+m[h].value+'"'+m[h].language;
break;
case"date":k+="<"+m[h].property+'>"'+m[h].value+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>'
}k+=";"
}k+="<"+d.DC_TERMS+'modified>"'+o+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>.} WHERE {OPTIONAL {<'+j+"><"+d.DC_TERMS+"modified>?_mod}}}";
if(e.DEBUG){console.debug(k)
}f.update(k,g,l)
},broaderNarrower:function(k,l,h,g,j){var m=b();
var i="WITH <"+k+"> DELETE {<"+h+"><"+d.DC_TERMS+"modified>?_mod1.<"+l+"><"+d.DC_TERMS+"modified>?_mod2} INSERT {<"+l+"> <"+d.SKOS+"narrower> <"+h+">;<"+d.DC_TERMS+'modified>"'+m+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>.<'+h+"> <"+d.SKOS+"broader> <"+l+">;<"+d.DC_TERMS+'modified>"'+m+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>} WHERE { OPTIONAL {<'+h+"><"+d.DC_TERMS+"modified>?_mod1} OPTIONAL {<"+l+"><"+d.DC_TERMS+"modified>?_mod2}}";
if(e.DEBUG){console.debug(i)
}f.update(i,g,j)
},topConcept:function(k,h,m,g,j){var l=b();
var i="WITH <"+k+"> DELETE {<"+h+"><"+d.DC_TERMS+"modified>?_mod1.<"+m+"><"+d.DC_TERMS+"modified>?_mod2} INSERT {<"+h+"> <"+d.SKOS+"hasTopConcept> <"+m+">;<"+d.DC_TERMS+'modified>"'+l+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>.<'+m+"> <"+d.SKOS+"topConceptOf> <"+h+">;<"+d.DC_TERMS+'modified>"'+l+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>} WHERE {OPTIONAL {<'+h+"><"+d.DC_TERMS+"modified>?_mod1} OPTIONAL {<"+m+"><"+d.DC_TERMS+"modified>?_mod2}}";
if(e.DEBUG){console.debug(i)
}f.update(i,g,j)
},related:function(l,i,h,g,k){var m=b();
var j="WITH <"+l+"> DELETE {<"+i+"><"+d.DC_TERMS+"modified>?_mod1.<"+h+"><"+d.DC_TERMS+"modified>?_mod2} INSERT {<"+i+"> <"+d.SKOS+"related> <"+h+">;<"+d.DC_TERMS+'modified>"'+m+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>.<'+h+"> <"+d.SKOS+"related> <"+i+">;<"+d.DC_TERMS+'modified>"'+m+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>} WHERE {OPTIONAL {<'+i+"><"+d.DC_TERMS+"modified>?_mod1}OPTIONAL {<"+h+"><"+d.DC_TERMS+"modified>?_mod2}}";
if(e.DEBUG){console.debug(j)
}f.update(j,g,k)
},graphLanguages:function(m,n,g,l){var k="";
for(var h in n){k+="<"+m+"><"+d.SKOSJS+'hasLanguage>"'+n[h]+'".'
}var j="WITH <"+m+"> DELETE {<"+m+"><"+d.SKOSJS+"hasLanguage>?_lang} WHERE {OPTIONAL{<"+m+"><"+d.SKOSJS+"hasLanguage>?_lang}}";
if(e.DEBUG){console.debug(j)
}f.update(j,function(){j="INSERT DATA {GRAPH <"+m+">{"+k+"}}";
if(e.DEBUG){console.debug(j)
}f.update(j,g,l)
},l)
},graphFirstLanguage:function(j,k,g,i){var h="WITH <"+j+"> DELETE {<"+j+"><"+d.SKOSJS+"hasFirstLanguage>?_firstLang}INSERT {<"+j+"><"+d.SKOSJS+'hasFirstLanguage>"'+k+'".} WHERE { OPTIONAL {<'+j+"><"+d.SKOSJS+"hasFirstLanguage>?_firstLang}}";
if(e.DEBUG){console.debug(h)
}f.update(h,g,i)
}};
this.update={value:function(o,h,n,m,g,i,p,j){var k=b();
i=i&&i!="none"?"@"+i:"";
var l="WITH <"+o+"> DELETE {<"+h+"> <"+n+'> "'+m+'"'+i+";<"+d.DC_TERMS+"modified>?_mod} INSERT {<"+h+"> <"+n+'> "'+g+'"'+i+";<"+d.DC_TERMS+'modified>"'+k+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>.} WHERE {<'+h+"> <"+n+'> "'+m+'"'+i+".OPTIONAL {<"+h+"><"+d.DC_TERMS+"modified>?_mod}}";
if(e.DEBUG){console.debug(l)
}f.update(l,p,j)
},uri:function(n,h,m,l,g,o,i){var j=b();
var k="WITH <"+n+"> DELETE {<"+h+"> <"+m+"> <"+l+">;<"+d.DC_TERMS+"modified>?_mod} INSERT {<"+h+"> <"+m+"> <"+g+">;<"+d.DC_TERMS+'modified>"'+j+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>.} WHERE {<'+h+"> <"+m+"> <"+l+">.OPTIONAL {<"+h+"><"+d.DC_TERMS+"modified>?_mod}}";
if(e.DEBUG){console.debug(k)
}f.update(k,o,i)
}};
this._delete={value:function(n,g,m,l,h,o,i){var j=b();
h=h&&h!="none"?"@"+h:"";
var k="WITH <"+n+"> DELETE {<"+g+"> <"+m+'> "'+l+'"'+h+";<"+d.DC_TERMS+"modified>?_mod} INSERT {<"+g+"><"+d.DC_TERMS+'modified>"'+j+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>} WHERE {OPTIONAL {<'+g+"> <"+d.DC_TERMS+"modified>?_mod}}";
if(e.DEBUG){console.debug(k)
}f.update(k,o,i)
},uri:function(m,h,l,k,g,j){var n=b();
var i="WITH <"+m+"> DELETE {<"+h+"> <"+l+"> <"+k+">;<"+d.DC_TERMS+"modified>?_mod} INSERT {<"+h+"><"+d.DC_TERMS+'modified>"'+n+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>} WHERE {OPTIONAL {<'+h+"> <"+d.DC_TERMS+"modified>?_mod}}";
if(e.DEBUG){console.debug(i)
}f.update(i,g,j)
},broaderNarrower:function(k,l,h,g,j){var m=b();
var i="WITH <"+k+"> DELETE {<"+h+"> <"+d.SKOS+"broader> <"+l+">;<"+d.DC_TERMS+"modified>?_mod1.<"+l+"> <"+d.SKOS+"narrower> <"+h+">;<"+d.DC_TERMS+"modified>?_mod2} INSERT {<"+l+"><"+d.DC_TERMS+'modified>"'+m+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>.<'+h+"><"+d.DC_TERMS+'modified>"'+m+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>} WHERE {OPTIONAL {<'+h+"><"+d.DC_TERMS+"modified>?_mod1}OPTIONAL {<"+l+"><"+d.DC_TERMS+"modified>?_mod}}";
if(e.DEBUG){console.debug(i)
}f.update(i,g,j)
},topConcept:function(k,h,m,g,j){var l=b();
var i="WITH <"+k+"> DELETE {<"+h+"> <"+d.SKOS+"hasTopConcept> <"+m+">;<"+d.DC_TERMS+"modified>?_mod1.<"+m+"> <"+d.SKOS+"topConceptOf> <"+h+">;<"+d.DC_TERMS+"modified>?_mod2} INSERT {<"+h+"><"+d.DC_TERMS+'modified>"'+l+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>.<'+m+"><"+d.DC_TERMS+'modified>"'+l+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>} WHERE {OPTIONAL {<'+h+"> <"+d.DC_TERMS+"modified>?_mod1}OPTIONAL {<"+m+"> <"+d.DC_TERMS+"modified>?_mod2}}";
if(e.DEBUG){console.debug(i)
}f.update(i,g,j)
},related:function(l,i,h,g,k){var m=b();
var j="WITH <"+l+"> DELETE {<"+i+"> <"+d.SKOS+"related> <"+h+">;<"+d.DC_TERMS+"modified>?_mod1.<"+h+"> <"+d.SKOS+"topConceptOf> <"+i+">;<"+d.DC_TERMS+"modified>?_mod2} INSERT {<"+i+"><"+d.DC_TERMS+'modified>"'+m+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>.<'+h+"><"+d.DC_TERMS+'modified>"'+m+'"^^<http://www.w3.org/2001/XMLSchema#dateTime>} WHERE {OPTIONAL {<'+i+"><"+d.DC_TERMS+"modified>?_mod1}OPTIONAL {<"+h+"><"+d.DC_TERMS+"modified>?_mod2}}";
if(e.DEBUG){console.debug(j)
}f.update(j,g,k)
},concept:function(k,h,g,j){var i="WITH <"+k+"> DELETE {<"+h+">?x?z.?a?b<"+h+">} WHERE {<"+h+">?x?z.OPTIONAL{?a?b<"+h+">}}";
if(e.DEBUG){console.debug(i)
}f.update(i,g,j)
},skosRelations:function(k,h,g,j){var i="WITH <"+k+"> DELETE {<"+h+"><"+d.SKOS+"broader>?z.?a<"+d.SKOS+"narrower><"+h+">.<"+h+"><"+d.SKOS+"narrower>?r.?q<"+d.SKOS+"broader><"+h+">.<"+h+"><"+d.SKOS+"topConceptOf>?z.?a<"+d.SKOS+"hasTopConcept><"+h+">} WHERE {OPTIONAL{<"+h+"><"+d.SKOS+"broader>?z.?a<"+d.SKOS+"narrower><"+h+">.}OPTIONAL{<"+h+"><"+d.SKOS+"narrower>?r.?q<"+d.SKOS+"broader><"+h+">.}OPTIONAL{<"+h+"><"+d.SKOS+"topConceptOf>?z.?a<"+d.SKOS+"hasTopConcept><"+h+">}}";
if(e.DEBUG){console.debug(i)
}f.update(i,g,j)
},graph:function(j,g,i){var h="DROP GRAPH <"+j+">";
if(e.DEBUG){console.debug(h)
}f.update(h,g,i)
}};
this.get={parent:function(k,h,g,j){var i="SELECT ?uri ?isScheme {GRAPH <"+k+"> { <"+h+"> (<"+d.SKOS+"broader>|<"+d.SKOS+"topConceptOf>) ?uri. BIND (EXISTS {?uri <"+d.RDF+"type> <"+d.SKOS+"ConceptScheme>} AS ?isScheme)}}";
if(e.DEBUG){console.log(i)
}f.select(i,g,j)
},graph:function(j,g,i){var k="";
var h="SELECT DISTINCT ?title WHERE { {GRAPH <"+j+"> { <"+j+"> <"+d.RDF+"type><"+d.SKOSJS+"Project> }}UNION {GRAPH <"+j+"> { ?a <"+d.RDF+"type><"+d.SKOS+"Concept> }}OPTIONAL {GRAPH <"+j+"> {<"+j+"> <"+e.LABEL_GRAPH+"> ?title.}}}";
if(e.DEBUG){console.debug(h)
}f.select(h,g,i)
},scheme:function(k,h,g,j){var l=e.LANGUAGE=="none"?"":e.LANGUAGE;
var i="SELECT DISTINCT ?title ?children {GRAPH <"+k+"> {OPTIONAL { <"+h+"> <"+e.LABEL_SCHEME+"> ?title. FILTER (lang(?title) = '"+l+"') }BIND ( EXISTS { <"+h+">  <"+d.SKOS+"hasTopConcept> ?_top } AS ?children )}}";
if(e.DEBUG){console.debug(i)
}f.select(i,g,j)
},concept:function(k,h,g,j){var l=e.LANGUAGE=="none"?"":e.LANGUAGE;
var i="SELECT DISTINCT ?title ?children {GRAPH <"+k+"> {OPTIONAL { <"+h+"> <"+d.SKOS+"prefLabel> ?title . FILTER (lang(?title) = '"+l+"') }BIND ( EXISTS { <"+h+">  <"+d.SKOS+"narrower> ?_narrow } AS ?children )}}";
if(e.DEBUG){console.debug(i)
}f.select(i,g,j)
},graphFirstLanguage:function(j,g,i){var h="SELECT ?language WHERE {GRAPH <"+j+">{<"+j+"> <"+d.SKOSJS+"hasFirstLanguage> ?language}}";
if(e.DEBUG){console.debug(h)
}f.select(h,g,i)
}};
this.list={graphs:function(g,i){var j=e.LANGUAGE=="none"?"":e.LANGUAGE;
var h="SELECT DISTINCT ?uri ?title WHERE { {GRAPH ?uri { ?uri <"+d.RDF+"type><"+d.SKOSJS+"Project> }}UNION {GRAPH ?uri { ?a <"+d.RDF+"type><"+d.SKOS+"Concept> }}OPTIONAL {?uri <"+e.LABEL_GRAPH+"> ?title.}}";
if(e.DEBUG){console.debug(h)
}f.select(h,g,i)
},schemes:function(j,g,i){var k=e.LANGUAGE=="none"?"":e.LANGUAGE;
var h="SELECT DISTINCT ?uri ?title ?children {GRAPH <"+j+"> {?uri a <"+d.SKOS+"ConceptScheme>.OPTIONAL { ?uri <"+e.LABEL_SCHEME+"> ?title. FILTER (lang(?title) = '"+k+"') }BIND ( EXISTS { ?uri <"+d.SKOS+"hasTopConcept> ?_top } AS ?children )}}";
if(e.DEBUG){console.debug(h)
}f.select(h,g,i)
},top_concepts:function(k,h,g,j){var l=e.LANGUAGE=="none"?"":e.LANGUAGE;
var i="SELECT DISTINCT ?uri ?title ?children {GRAPH <"+k+">  {<"+h+"> <"+d.SKOS+"hasTopConcept> ?uri.OPTIONAL { ?uri <"+d.SKOS+"prefLabel> ?title . FILTER (lang(?title) = '"+l+"') }BIND ( EXISTS { ?uri <"+d.SKOS+"narrower> ?_narrow } AS ?children )}}";
if(e.DEBUG){console.debug(i)
}f.select(i,g,j)
},narrower:function(k,h,g,j){var l=e.LANGUAGE=="none"?"":e.LANGUAGE;
var i="SELECT DISTINCT ?uri ?title ?children {GRAPH <"+k+"> {<"+h+"> <"+d.SKOS+"narrower> ?uri.OPTIONAL { ?uri <"+d.SKOS+"prefLabel> ?title . FILTER (lang(?title) = '"+l+"') }BIND ( EXISTS { ?uri <"+d.SKOS+"narrower> ?_narrow } AS ?children )}}";
if(e.DEBUG){console.debug(i)
}f.select(i,g,j)
},values:function(l,h,k,g,j){var i="SELECT ?value {GRAPH <"+l+"> {<"+h+"> <"+k+"> ?value}}";
if(e.DEBUG){console.debug(i)
}f.select(i,g,j)
},concepts:function(l,h,k,g,j){var m=e.LANGUAGE=="none"?"":e.LANGUAGE;
var i="SELECT ?uri ?title {GRAPH <"+l+"> {<"+h+"> <"+k+"> ?uri. OPTIONAL { ?uri <"+d.SKOS+"prefLabel> ?title. FILTER (lang(?title) = '"+m+"')}}}";
if(e.DEBUG){console.debug(i)
}f.select(i,g,j)
},freeConcepts:function(j,g,i){var k=e.LANGUAGE=="none"?"":e.LANGUAGE;
var h="SELECT ?uri ?title ?children WHERE {GRAPH <"+j+"> {?uri <"+d.RDF+"type> <"+d.SKOS+"Concept>. FILTER NOT EXISTS {?_sub1 <"+d.SKOS+"narrower> ?uri}. FILTER NOT EXISTS {?_sub2 <"+d.SKOS+"hasTopConcept> ?uri}.OPTIONAL{ ?uri <"+d.SKOS+"prefLabel> ?title.FILTER(lang(?title)='"+k+"')}BIND(EXISTS {?uri <"+d.SKOS+"narrower> ?_narrow} AS ?children)}}";
if(e.DEBUG){console.debug(h)
}f.select(h,g,i)
},graphLanguages:function(j,g,i){var h="SELECT ?language WHERE {GRAPH <"+j+">{<"+j+"> <"+d.SKOSJS+"hasLanguage> ?language}}";
if(e.DEBUG){console.debug(h)
}f.select(h,g,i)
},incomings:function(k,h,g,j){var i="SELECT DISTINCT ?uri WHERE {GRAPH <"+k+"> {?uri ?property <"+h+">}}";
if(e.DEBUG){console.debug(i)
}f.select(i,g,j)
}};
this.search={suggestion:function(k,m,h,l,g,j){var n=e.LANGUAGE=="none"?"":e.LANGUAGE;
var i="Select DISTINCT ?uri ?text ?scheme {GRAPH<"+k+"> {?uri <"+d.RDF+"type> <"+d.SKOS+"Concept>;<"+d.SKOS+"prefLabel> ?text.OPTIONAL{?uri <"+d.SKOS+"altLabel> ?alt_text.}OPTIONAL{?uri <"+d.SKOS+"inScheme> ?scheme_uri. ?scheme_uri <"+d.RDFS+"label> ?scheme.FILTER (lang(?scheme) = '"+n+"') }FILTER (regex(str(?text), \""+m+'" '+(l?"":',"i"')+')||regex(str(?alt_text), "'+m+'" '+(l?"":',"i"')+")).FILTER (lang(?text) = '"+n+"')}} LIMIT "+h;
if(e.DEBUG){console.debug(i)
}f.select(i,g,j)
}};
function b(){var k=new Date();
var j=k.getMonth()+1;
var h=k.getDate();
var g=k.getHours();
var i=k.getMinutes();
var l=k.getSeconds();
return k.getFullYear()+"-"+(j<10?("0"+j):j)+"-"+(h<10?("0"+h):h)+"T"+(g<10?("0"+g):g)+":"+(i<10?("0"+i):i)+":"+(l<10?("0"+l):l)
}this.getSelectEndpoint=function(){};
this.setSelectEndpoint=function(g){};
this.getUpdateEndpoint=function(){};
this.setUpdateEndpoint=function(g){}
};
var HTML_TEMPLATES={search:'<div id="search_div">   <span id="search_label">Search:</span><input id="search_input" type="text"><span id="search_loader" style="display: none">&nbsp;</span>   <div style="display: none" id="search_suggestion"></div></div>',about:'<style type="text/css">   #about_info_table {margin-left: 10px;}   #about_info_table td{text-align: left;}   #about_info_table td.title{font-weight: bold;width: 100px;vertical-align: top;}</style><h2 style="margin-bottom:5px;"><span id="about-skosjs">&nbsp;</span></h2><h3 style="margin-top:0;">A SPARQL 1.1 based SKOS Editor</h3><table id="about_info_table">   <tr><td class="title">Version</td><td>0.2.0 (alpha)</td></tr>   <tr><td class="title">Author</td><td>Thomas Kurz</td></tr>   <tr><td class="title">Contact</td><td>thomas.kurz@salzburgresearch.at</td></tr>   <tr><td class="title">License</td><td>Apache License, Version 2.0</td></tr></table>',views:{resource:{basic:'<style type="text/css">   .view_header .header_uri{margin: 5px;padding: 5px 0 0;font-size: 12px;font-weight: normal;}   #view_header_uri{color: gray;font-style: italic;padding-top:3px;}</style><div class="view_header">   <h1 class="header_uri"><span class="draghandle"><span id="view_header_rdf_link" title="Open in Linked Data Browser">&nbsp;</span>&nbsp;<span id="view_header_uri"></span></span>&nbsp;<button class="button" id="view_header_uri_delete"><i class="icon-trash"></i></button></h1></div><div id="view_content" style="margin:10px 0 0">   <div style="float:left;width: 50%">       <div  id="view_content_left" class="content"></div>   </div>   <div style="float:left;width: 50%">       <div id="view_content_right" class="content"></div>   </div>   <div style="clear:both;"></div></div>',add:'<tr><td colspan="3">   <div style="width:100%;height:18px;text-align:right;">       <button class="button add"><i class="icon-plus"></i></button>   </div></td></tr>',concept:{edit:'<tr class="view_display">   <td style="width:30px;"></td>   <td><div style="width: 100%;height:23px;padding-top:3px;">       <div class="concept_text"></div>   </div></td>   <td style="width:45px;"><div style="width:100%;height:21px;">       <button class="button concept_delete"><i class="icon-trash"></i></button>   </div></td></tr>',fix:'<tr class="view_display">   <td style="width:30px;"></td>   <td><div style="width: 100%;height:23px;padding-top:3px;"><div class="concept_text"></div></div></td>   <td style="width:40px;"></td></tr>'},literal:{view:'<tr class="view_display">   <td><div style="width: 100%;min-height:25px;"><div style="border: 1px dashed #d3d3d3;min-height:16px;margin-right: 3px;padding-left:2px;cursor:text">       <div class="literal_text" style="width:100%;border:none;margin:0;font-size: 12px;padding-top: 2px;overflow: auto;"></div>       </div></div>   </td>   <td style="width:40px;">       <div style="width:100%;height:23px;">           <button class="button literal_edit"><i class="icon-pencil"></i></button>           <button class="button literal_delete"><i class="icon-trash"></i></button>       </div>   </td></tr>',edit:'<tr class="view_edit" style="display:none">   <td>       <div style="width: 100%;height:25px;"><div style="overflow:hidden;border: 2px dotted #FFC414;height:16px;margin-right: 3px;padding-left:1px;overflow: hidden">           <input class="literal_input" type="text" style="width:100%;border:none;margin:0;font-size: 12px;margin-top: -1px">       </div></div>   </td>   <td style="width:40px;">       <div style="width:100%;height:23px;">           <button class="button literal_save"><i class="icon-upload-alt"></i></button>           <button class="button literal_cancel"><i class="icon-remove"></i></button>       </div>   </td></tr>',fix:'<tr class="view_display">   <td>       <div style="width: 100%;min-height:25px;"><div style="border: 1px dashed #d3d3d3;min-height:16px;margin-right: 3px;padding-left:2px">           <div class="literal_text" style="width:100%;border:none;margin:0;font-size: 12px;padding-top: 3px;overflow: auto;"></div>       </div></div>   </td></tr>'},text:{view:'<tr class="view_display">   <td>       <div style="width: 100%;height:86px;"><div style="border: 1px dashed #d3d3d3;height:83px;margin-right: 3px;padding-left:2px;cursor:text;overflow: auto;">           <div class="literal_text" style="width:100%;border:none;margin:0;font-size: 12px;padding-top: 3px;overflow: auto;min-height:77px"></div>       </div></div>   </td>   <td style="width:40px;vertical-align: bottom;">       <div style="width:100%;height:18px;">           <button class="button literal_edit"><i class="icon-pencil"></i></button>           <button class="button literal_delete"><i class="icon-trash"></i></button>       </div>   </td></tr>',edit:'<tr class="view_edit" style="display:none">   <td><div style="width: 100%;"><div style="border: 2px dotted #FFC414;margin-right: 3px;padding-left:1px;overflow: auto;">       <textarea rows="5" class="literal_input" type="text" style="width:100%;border:none;margin:0;font-size: 12px;padding-top: 1px;resize: none;font-family: helvetica,arial,clean,sans-serif;padding-top:2px;"></textarea>   </div></div></td>   <td style="width:40px;vertical-align: bottom;">       <div style="width:100%;height:18px;">           <button class="button literal_save"><i class="icon-upload-alt"></i></button>           <button class="button literal_cancel"><i class="icon-remove"></i></button>       </div>   </td></tr>',fix:'<tr class="view_display">   <td>       <div style="width: 100%;height:101px;"><div style="border: 1px dashed #d3d3d3;height:98px;margin-right: 3px;padding-left:2px;overflow:auto;">           <div class="literal_text" style="width:100%;border:none;margin:0;font-size: 14px;padding-top: 3px;overflow: auto;min-height:86px"></div>       </div></div>   </td></tr>'}}},popups:{custom:'<style type="text/css">   h1#popup_title {margin:0;padding:6px;background-color:#FFC414;color: black;font-size: 14px;border-bottom: 1px solid black;border-top: 1px solid #d3d3d3;border-right: 1px solid #d3d3d3;border-left: 1px solid #d3d3d3;}</style><div id="popup_custom" style="width:500px;margin-left:-250px;top:100px;border:1px solid black;background-color:white;position:relative;display:none">   <h1 id="popup_title"></h1>   <span id="popup_close">&nbsp;</span>   <div id="popup_content" style="text-align: center;padding:10px 0;">   </div></div>',alert:'<style type="text/css">   h1#popup_title {margin:0;font-size: 14px;border-bottom: 1px solid black;border-top: 1px solid #d3d3d3;border-right: 1px solid #d3d3d3;border-left: 1px solid #d3d3d3;}</style><div style="width:300px;margin-left:-150px;top:100px;border:1px solid black;background-color:white;position:relative">   <h1 id="popup_title" class="alert_title">Alert</h1>   <span id="popup_close">&nbsp;</span>   <div style="text-align: center;padding:10px 0;">       <div style="margin-right: 10px;font-size: 12px" id="popup_message"></div>       <div style="margin-top:10px;width: 100%;">           <button id="popup_cancel">OK</button>       </div>   </div></div>',concept:'<style type="text/css">   h1#popup_title {margin:0;padding:6px;background-color:#FFC414;color: black;font-size: 14px;border-bottom: 1px solid black;border-top: 1px solid #d3d3d3;border-right: 1px solid #d3d3d3;border-left: 1px solid #d3d3d3;}</style><div style="width:500px;margin-left:-250px;top:100px;border:1px solid black;background-color:white;position:relative">   <h1 id="popup_title">Create Concept</h1>   <span id="popup_close">&nbsp;</span>   <div style="text-align: center;padding:10px 0;">       <span style="margin-right: 10px;font-size: 12px">Title:</span>       <input style="width:390px" type="text" id="popup_input">       <div style="margin-top:10px;width: 100%;">           <button id="popup_create">Create</button>       </div>   </div></div>',graph:'<style type="text/css">   .popup h1{margin:0;padding:6px;background-color:#FFC414;color: black;font-size: 14px;border-bottom: 1px solid black;border-top: 1px solid #d3d3d3;border-right: 1px solid #d3d3d3;border-left: 1px solid #d3d3d3;}   .popup h2 {font-size: 14px;padding-left: 10px;font-weight: normal;margin: 7px 0 1px;}   .popup ul {margin: 0;padding: 0;text-align: left;list-style-type: none;}   .popup .info {color:red;font-size:10px;display: block;margin-top: 5px;}</style><div class="popup" style="width:500px;margin-left:-250px;top:100px;border:1px solid black;background-color:white;position:relative">   <h1>Select / Create Graph</h1>   <span id="popup_close">&nbsp;</span>   <h2>Select existing Graph:</h2>   <div style="width:480px;padding: 5px;max-height:200px;overflow-y:auto;text-align: center">       <span id="popup_loading">&nbsp;</span>       <ul id="popup_list" class="project_list"></ul>       <span id="popup_empty_list" style="display:none;font-size: 12px;">No existing Graphs</span>   </div>   <hr style="margin:10px;">   <h2>Create new Graph:</h2>   <div style="margin:10px 0;width: 100%;text-align: center;font-size: 12px">       <span style="margin-right: 5px">Title:</span>       <input style="width:390px" type="text" id="popup_input"><br>       <button style="margin-top:10px" id="popup_create">Create</button><br>   </div></div>',info:'<style type="text/css">   h1#popup_title {margin:0;font-size: 14px;border-bottom: 1px solid black;border-top: 1px solid #d3d3d3;border-right: 1px solid #d3d3d3;border-left: 1px solid #d3d3d3;}</style><div style="width:300px;margin-left:-150px;top:100px;border:1px solid black;background-color:white;position:relative">   <h1 id="popup_title" class="info_title">Info</h1>   <span id="popup_close">&nbsp;</span>   <div style="text-align: center;padding:10px 0;">       <div style="margin-right: 10px;font-size: 12px" id="popup_message"></div>       <div style="margin-top:10px;width: 100%;">           <button id="popup_cancel">OK</button>       </div>   </div></div>',confirm:'<style type="text/css">   h1#popup_title {margin:0;font-size: 14px;border-bottom: 1px solid black;border-top: 1px solid #d3d3d3;border-right: 1px solid #d3d3d3;border-left: 1px solid #d3d3d3;}</style><div style="width:300px;margin-left:-150px;top:100px;border:1px solid black;background-color:white;position:relative">   <h1 id="popup_title" class="confirm_title">Choice</h1>   <span id="popup_close">&nbsp;</span>   <div style="text-align: center;padding:10px 0;">       <div style="margin: 10px;font-size: 12px" id="popup_message"></div>       <div id="popup_button_list" style="margin-top:10px;width: 100%;">           <button id="popup_cancel">Cancel</button>       </div>   </div></div>',settings:'<style type="text/css">h1#popup_title {margin:0;padding:6px;background-color:#FFC414;color: black;font-size: 14px;border-bottom: 1px solid black;border-top: 1px solid #d3d3d3;border-right: 1px solid #d3d3d3;border-left: 1px solid #d3d3d3;}ul#settingslist {margin:0;list-style: none;padding: 0}ul#settingslist  li{border-bottom: 1px dashed white;padding:5px;color:#333333;}ul#settingslist li.active{font-weight: bold;}ul#settingslist li:hover{cursor:pointer;font-weight: bold;}ul#settings_language_list {list-style: none;padding: 0;margin: 0;}ul#settings_language_list li {margin: 0;padding: 0 0 5px;}ul#settings_language_list span {border: 1px solid #999;padding: 1px 3px;border-radius: 2px 2px 2px 2px;background-color: #f3f3f3;}</style><div style="width:500px;margin-left:-250px;top:100px;border:1px solid black;background-color:white;position:relative;height:400px">    <h1 id="popup_title" class="alert_title">Settings</h1>    <span id="popup_close" class="popup_cancel">&nbsp;</span>    <div>        <div style="font-size: 12px;float:left;background-color:white;border-bottom:1px solid #bbbbbb">            <div style="width:200px;float:left;background-color: #d3d3d3; height:330px;">                <ul id="settingslist">                     <li class="active" onclick="__activate(this)" name="language">Languages</li>                     <!--<li onclick="__activate(this)" name="other">Other</li>-->                </ul>            </div>            <div style="width:300px;float:left;height:300px">                <div class="settingslist_current" id="settingslist_language" style="padding: 5px">                       <table>                           <tr><td style="vertical-align:top;width:190px;padding-top: 5px;">Displayed Languages</td><td>                               <ul id="settings_language_list">                                   <!--<li><span>de</span><button class="button"><i class="icon-minus"></i></button></li>                                   <li><span>en</span><button class="button"><i class="icon-minus"></i></button></li>-->                               </ul>                           </td></tr>                           <tr><td>Add Language</td><td>                               <input id="settings_language_newLanguageInput" type="text" maxlength="5" style="width: 40px">                               <button id="settings_language_newLanguageButton" class="button"><i class="icon-plus"></i></button>                           </td></tr>                           <tr><td>First Language</td><td>                               <select id="settings_language_firstLanguageSelect">                                   <!--<option>none</option>                                   <option>de</option>-->                               </select>                           </td></tr>                       </table>                       <p style="color:red" id="settings_language_info"></p>                </div>                <div style="display:none;padding: 5px" id="settingslist_other">                     No more Settings possible at the moment ...                </div>            </div>            <div class="clear"></div>        </div>        <div style="margin-top:10px;width: 100%;text-align: center;float:left;">            <button class="popup_cancel">OK</button>        </div>        <div class="clear"></div>    </div></div>'}};
function SKOSEditor(e){var t={RDF_LINK:function(A){window.open(A)
},BASE_URI:"http://localhost:8080/LMF/resource/",LANGUAGES_SUPPORTED:["de","it"],ENDPOINT_SELECT:"http://localhost:8080/LMF/sparql/select",ENDPOINT_UPDATE:"http://localhost:8080/LMF/sparql/update",LANGUAGE:"de",DEBUG:false,COOKIES_ENABLED:true,COOKIE_EXPIRE_DAYS:7,LABEL_GRAPH:"http://purl.org/dc/terms/title",LABEL_SCHEME:"http://www.w3.org/2000/01/rdf-schema#label"};
$.extend(t,e);
var o={graph:{left:[{title:"Title",property:"http://purl.org/dc/terms/title",type:"string",multivalue:false,multilingual:false,editable:true},{title:"Subject",property:"http://purl.org/dc/terms/subject",type:"string",multivalue:false,multilingual:true,editable:true},{title:"Description",property:"http://purl.org/dc/terms/description",type:"text",multivalue:false,multilingual:true,editable:true}],right:[{title:"Author",property:"http://purl.org/dc/terms/creator",type:"uri",multivalue:false,multilingual:false,editable:false},{title:"Created",property:"http://purl.org/dc/terms/created",type:"string",multivalue:false,multilingual:false,editable:false},{title:"Publisher (Organisation)",property:"http://purl.org/dc/terms/publisher",type:"string",multivalue:true,multilingual:false,editable:true},{title:"Contributors",property:"http://purl.org/dc/terms/contributor",type:"uri",multivalue:true,multilingual:false,editable:false}]},scheme:{left:[{title:"Top Concepts",property:"http://www.w3.org/2004/02/skos/core#hasTopConcept",type:"concept",droppable:true,editable:true}],right:[{title:"Title",property:"http://www.w3.org/2000/01/rdf-schema#label",type:"string",multivalue:false,multilingual:true,editable:true},{title:"Description",property:"http://purl.org/dc/terms/description",type:"text",multivalue:false,multilingual:true,editable:true},{title:"Author",property:"http://purl.org/dc/terms/creator",type:"uri",multivalue:false,multilingual:false,editable:false},{title:"Created",property:"http://purl.org/dc/terms/created",type:"string",multivalue:false,multilingual:false,editable:false},{title:"Modified",property:"http://purl.org/dc/terms/modified",type:"string",multivalue:false,multilingual:false,editable:false},{title:"Publisher (Organisation)",property:"http://purl.org/dc/terms/publisher",type:"string",multivalue:true,multilingual:false,editable:true},{title:"Contributors",property:"http://purl.org/dc/terms/contributor",type:"uri",multivalue:true,multilingual:false,editable:false},{title:"License",property:"http://purl.org/dc/terms/license",type:"uri",multivalue:true,droppable:false,editable:true}]},concept:{left:[{title:"Broader Concepts",property:"http://www.w3.org/2004/02/skos/core#broader",type:"concept",droppable:true,editable:true},{title:"Narrower Concepts",property:"http://www.w3.org/2004/02/skos/core#narrower",type:"concept",droppable:true,editable:true},{title:"Related Concepts",property:"http://www.w3.org/2004/02/skos/core#related",type:"concept",droppable:true,editable:true},{title:"Broad Match",property:"http://www.w3.org/2004/02/skos/core#broadMatch",type:"concept",droppable:true,editable:true},{title:"Narrow Match",property:"http://www.w3.org/2004/02/skos/core#narrowMatch",type:"concept",droppable:true,editable:true},{title:"Close Match",property:"http://www.w3.org/2004/02/skos/core#closeMatch",type:"concept",droppable:true,editable:true},{title:"Exact Match",property:"http://www.w3.org/2004/02/skos/core#exactMatch",type:"concept",droppable:true,editable:true}],right:[{title:"Preferred Label",property:"http://www.w3.org/2004/02/skos/core#prefLabel",type:"string",multivalue:false,multilingual:true,editable:true},{title:"Alternative Label",property:"http://www.w3.org/2004/02/skos/core#altLabel",type:"string",multivalue:true,multilingual:true,editable:true},{title:"Hidden Label",property:"http://www.w3.org/2004/02/skos/core#hiddenLabel",type:"string",multivalue:true,multilingual:true,editable:true},{title:"Author",property:"http://purl.org/dc/terms/creator",type:"uri",multivalue:false,multilingual:false,editable:false},{title:"Created",property:"http://purl.org/dc/terms/created",type:"string",multivalue:false,multilingual:false,editable:false},{title:"Modified",property:"http://purl.org/dc/terms/modified",type:"string",multivalue:false,multilingual:false,editable:false},{title:"Contributors",property:"http://purl.org/dc/terms/contributor",type:"uri",multivalue:true,multilingual:false,editable:false},{title:"Definition",property:"http://www.w3.org/2004/02/skos/core#definition",type:"text",multivalue:false,multilingual:true,editable:true},{title:"Hidden Label",property:"http://www.w3.org/2004/02/skos/core#hiddenLabel",type:"string",multivalue:true,multilingual:true,editable:true}]}};
var b=new x();
var y={GRAPH:{CREATE:100,CREATED:101,SELECT:102,SELECTED:103,DELETE:104,DELETED:105,LOAD:106,UPDATED:107},CONCEPT:{CREATE:200,CREATED:201,SELECT:202,SELECTED:203,DELETE:204,DELETED:205,DRAGSTART:206,DRAGEND:207,UPDATED:208},SCHEME:{CREATE:300,CREATED:301,SELECT:302,SELECTED:303,DELETE:304,DELETED:305,UPDATED:306},PROPERTY:{CREATE:400,CREATED:401,SELECT:402,SELECTED:403,DELETE:404,DELETED:405,UPDATE:406,UPDATED:407},RELATION:{CREATED:500,DELETED:501},SETTINGS:{UPDATE:600,UPDATED:601},VIEW:{RELOAD:700}};
var v=new w();
var f=new SparqlClient(t.ENDPOINT_SELECT,t.ENDPOINT_UPDATE);
var r=new SKOSClient(f,{LANGUAGE:v.getLanguage(),DEBUG:t.DEBUG,ENDPOINT_SELECT:t.ENDPOINT_SELECT,ENDPOINT_UPDATE:t.ENDPOINT_UPDATE,LABEL_GRAPH:t.LABEL_GRAPH,LABEL_SCHEME:t.LABEL_SCHEME});
var a=new j("menu");
var p=new u("col1");
var c=new d("col2");
var l=new g("popup","popup_background");
var n=new m("search");
var q=new h();
function s(){a.init();
p.init();
c.init();
l.init();
v.init()
}var k={endpoint:{update:{get:function(){return f.getUpdateEndpoint()
},set:function(A){f.setUpdateEndpoint(A)
}},select:{get:function(){return f.getSelectEndpoint()
},set:function(A){f.setSelectEndpoint(A)
}}},menu:{createMenuItem:function(A,C,B){return a.createMenuItem(A,C,B)
},createSeperator:function(A){a.createSeperator(A)
}},event:{fire:function(A,C,B){b.fire(new z(A,C,B))
},bind:function(A,B){b.bind(A,B,arguments.callee.caller.toString().md5())
},unbind:function(A){b.unbind(arguments.callee.caller.toString().md5(),A)
}},popup:{info:function(B,A){l.info(B,A)
},alert:function(B,A){l.alert(B,A)
},custom:function(A){return l.custom(A)
}},properties:{add:function(C,D,F,A,B){A=A?A:"right";
var E={title:F.title?F.title:"No Title",property:D,type:F.type?F.type:"string",multivalue:F.multivalue?F.multivalue:true,multilingual:F.multilingual?F.multilingual:true,editable:F.editable?F.editable:true};
if(B!=undefined&&B<o[C][A].length){o[C][A].splice(B,0,E)
}else{o[C][A].push(E)
}},remove:function(C,D){var B=["left","right"];
for(var E in B){for(var A in o[C][B[E]]){if(o[C][B[E]][A].property==D){o[C][B[E]].splice(A,1);
break
}}}},alter:function(C,D,F){var B=["left","right"];
for(var E in B){for(var A in o[C][B[E]]){if(o[C][B[E]][A].property==D){if(F.title){o[C][B[E]][A].title=F.title
}if(F.type){o[C][B[E]][A].type=F.type
}if(F.multivalue){o[C][B[E]][A].multivalue=F.multivalue
}if(F.multilingual){o[C][B[E]][A].multilingual=F.multilingual
}if(F.editable){o[C][B[E]][A].editable=F.editable
}}}}}},EventCode:y,init:function(){s()
},authentification:{setAuthToken:function(A){f.setAuthToken(A)
}}};
return k;
function x(){var B=[];
this.fire=function(D){if(!B[D.type]){return
}for(var C=0;
C<B[D.type].length;
C++){B[D.type][C].action(D)
}if(t.DEBUG){console.debug("Fired Event:",D)
}};
this.bind=function(D,E,C){if(B[D]==undefined){B[D]=[]
}B[D].push(new A(C,E))
};
this.unbind=function(D,F){for(var G in B){if(F==undefined||G==F){var C=[];
for(var E=0;
E<B[G].length;
E++){if(B[G][E].name!=D){C.push(B[G][E])
}}B[G]=C
}}};
function A(C,D){this.name=C;
this.action=D
}}function z(A,C,B){this.type=A;
this.data=C;
this.source=B
}function w(){var B=this;
var F;
var H;
var G;
function C(J){var I=new Date();
document.cookie=J+"=undefined; expires="+I.toUTCString()
}function D(J,K){var I=new Date();
I.setDate(I.getDate()+t.COOKIE_EXPIRE_DAYS);
document.cookie=J+"="+escape(K)+"; expires="+I.toUTCString()
}function A(J){var K,I,M,L=document.cookie.split(";");
for(K=0;
K<L.length;
K++){I=L[K].substr(0,L[K].indexOf("="));
M=L[K].substr(L[K].indexOf("=")+1);
I=I.replace(/^\s+|\s+$/g,"");
if(I==J){return unescape(M)
}}return null
}function E(I){F=I;
r.get.graphFirstLanguage(F,function(J){if(J[0]&&J[0].language){H=J[0].language.value
}r.list.graphLanguages(F,function(L){var M=[];
M.push(H);
for(var K in L){if(L[K].language.value!=H){M.push(L[K].language.value)
}}if(L.length>0){G=M
}if(r){r.setLanguage(H)
}r.get.graph(F,function(N){var O=F;
if(N[0]&&N[0].title){O=N[0].title.value
}b.fire(new z(y.GRAPH.LOAD,{uri:F,title:O},B));
if(t.COOKIES_ENABLED){D("graph",F)
}},function(){l.alert("Error","Could not load graph");
if(t.COOKIES_ENABLED){C("graph")
}})
},function(){alert("could not read languages")
})
},function(){alert("could not read first language")
})
}this.reset=function(){H=t.LANGUAGE;
G=t.LANGUAGES_SUPPORTED
};
this.init=function(){if(t.COOKIES_ENABLED){var I=A("graph");
if(I){r.exists.graph(I,function(){b.fire(new z(y.GRAPH.SELECTED,{uri:I}))
},function(){l.alert("Error","Could not load graph");
if(t.COOKIES_ENABLED){C("graph")
}})
}}};
this.getLanguage=function(){return H
};
this.getLanguages=function(){return G
};
this.setLanguage=function(I){H=I
};
this.setLanguages=function(I){G=I
};
this.getGraph=function(){return F
};
b.bind(y.GRAPH.SELECTED,function(I){B.reset();
E(I.data.uri)
});
b.bind(y.SETTINGS.UPDATED,function(){b.fire(new z(y.GRAPH.SELECTED,{uri:F},B))
});
B.reset()
}function j(E){var J=this;
var I=[];
var H;
var A=$("<ul></ul>").addClass("menu").appendTo("#"+E);
this.init=function(){F()
};
this.createMenuItem=function(L,O,N,K){if(!I[L]){I[L]=$("<li></li>").html("<a>"+L+"</a><ul></ul>").appendTo(A);
I[L].hover(function(){I[L].addClass("hover");
$("ul:first",I[L]).css("visibility","visible")
},function(){I[L].removeClass("hover");
$("ul:first",I[L]).css("visibility","hidden")
})
}var K=K?"<span class='menu_shortcut'>"+K+"</span>":"";
var M=$("<li></li>").append($("<a></a>").html(O+K).click(function(){if(M.hasClass("disabled")){return false
}N()
})).appendTo(I[L].find("ul"));
return M
};
this.createSeperator=function(K){$("<hr>").addClass("seperator").appendTo(I[K].find("ul"))
};
var B=J.createMenuItem("Project","Open/Create Graph",function(){if(B.hasClass("disabled")){return false
}b.fire(new z(y.GRAPH.CREATE))
},"CTRL+g");
var G=J.createMenuItem("Project","Create Scheme/Concept",function(){if(G.hasClass("disabled")){return false
}b.fire(new z(y.CONCEPT.CREATE,H))
},"CTRL+n");
J.createSeperator("Project");
var C=J.createMenuItem("Project","Graph Settings",function(){if(C.hasClass("disabled")){return false
}b.fire(new z(y.SETTINGS.UPDATE,H))
});
var D=J.createMenuItem("Help","About",function(){l.info("About",HTML_TEMPLATES.about)
});
G.addClass("disabled");
C.addClass("disabled");
b.bind(y.GRAPH.SELECTED,function(K){G.removeClass("disabled");
C.removeClass("disabled");
H={uri:K.data.uri,type:"graph"}
});
b.bind(y.CONCEPT.SELECTED,function(K){H={uri:K.data.uri,type:K.data.type}
});
function F(){$(window).keydown(function(K){if(K.ctrlKey){switch(K.which){case 71:b.fire(new z(y.GRAPH.CREATE));
K.preventDefault();
break;
case 78:if(!G.hasClass("disabled")){b.fire(new z(y.CONCEPT.CREATE,H))
}K.preventDefault();
break
}}})
}}function u(C){var B=this;
var L;
var O;
var H;
var F;
b.bind(y.GRAPH.LOAD,function(P){N(P)
});
b.bind(y.PROPERTY.UPDATED,function(P){if(P.data.language==v.getLanguage()){if(P.data.property=="http://www.w3.org/2004/02/skos/core#prefLabel"||P.data.property=="http://www.w3.org/2000/01/rdf-schema#label"){$(".concept_"+P.data.uri.md5()).text(P.data.value)
}}else{if(P.data.property=="http://purl.org/dc/terms/title"){$(".concept_"+P.data.uri.md5()).text(P.data.value)
}}});
b.bind(y.PROPERTY.DELETED,function(P){if(P.data.language==v.getLanguage()){if(P.data.property=="http://www.w3.org/2004/02/skos/core#prefLabel"||P.data.property=="http://www.w3.org/2000/01/rdf-schema#label"){$(".concept_"+P.data.uri.md5()).text(P.data.uri)
}}else{if(P.data.property=="http://purl.org/dc/terms/title"){$(".concept_"+P.data.uri.md5()).text(P.data.value)
}}});
b.bind(y.PROPERTY.CREATED,function(P){if(P.data.language==v.getLanguage()){if(P.data.property=="http://www.w3.org/2004/02/skos/core#prefLabel"||P.data.property=="http://www.w3.org/2000/01/rdf-schema#label"){$(".concept_"+P.data.uri.md5()).text(P.data.value)
}}else{if(P.data.property=="http://purl.org/dc/terms/title"){$(".concept_"+P.data.uri.md5()).text(P.data.value)
}}});
b.bind(y.CONCEPT.SELECTED,function(P){if(P.source!=B){console.log("TODO: open to selected");
if(F.uri!=P.data.uri){$(".concept_"+F.uri.md5()).removeClass("activeNode");
F=P.data;
$(".concept_"+F.uri.md5()).addClass("activeNode")
}}});
b.bind(y.SCHEME.CREATED,function(P){F=P.data;
K()
});
b.bind(y.CONCEPT.CREATED,function(P){E(P.data)
});
b.bind(y.RELATION.CREATED,function(P){switch(P.data.type){case"broader":A(P.data.broader);
G();
break;
case"narrower":A(P.data.broader);
G();
break;
case"broaderNarrower":A(P.data.broader);
G();
break;
case"topConcept":A(P.data.parent);
G();
break
}});
b.bind(y.RELATION.DELETED,function(P){switch(P.data.type){case"broader":A(P.data.broader);
G();
break;
case"narrower":A(P.data.broader);
G();
break;
case"topConcept":A(P.data.parent);
G();
break
}});
this.init=function(){O=$("<ul></ul>").addClass("tree");
$("#"+C).empty().append(O);
D()
};
function D(){var Q;
var P=undefined;
var S=false;
$(window).keydown(function(T){if(L&&T.target.id!="search_input"&&$(".concept_"+F.uri.md5()).length>0){switch(T.keyCode){case 13:if(S){return false
}T.preventDefault();
if(!P){return false
}P.children().eq(1).click();
break;
case 37:if(S){return false
}T.preventDefault();
if(!P){R($(".concept_"+F.uri.md5()).parent())
}else{if(P.parent().hasClass("tree")){return false
}R(P.parent().parent())
}break;
case 38:if(S){return false
}T.preventDefault();
if(!P){R($(".concept_"+F.uri.md5()).parent())
}else{if(P.prev().length==0){R(P.parent().children().last())
}else{R(P.prev())
}}break;
case 39:if(S){return false
}T.preventDefault();
if(!P){R($(".concept_"+F.uri.md5()).parent())
}else{if(P.parent().hasClass("tree")){if(P.children().eq(2).children().length!=0){R(P.children().eq(2).children().first())
}}else{if(P.children().eq(0).hasClass("plus")){S=true;
var U=function(){setTimeout(function(){if(!P.children().eq(0).hasClass("minus")){U()
}else{R(P.children().eq(2).children().first());
S=false
}},200)
};
P.children().eq(0).click();
U()
}else{if(P.children().eq(0).hasClass("minus")){R(P.children().eq(2).children().first())
}}}}break;
case 40:if(S){return false
}T.preventDefault();
if(!P){R($(".concept_"+F.uri.md5()).parent())
}else{if(P.next().length==0){R(P.parent().children().first())
}else{R(P.next())
}}break
}}});
function R(T){P=T;
$(".navi").removeClass("navi");
T.addClass("navi");
window.clearTimeout(Q);
Q=window.setTimeout(function(){$(".navi").removeClass("navi");
P=undefined
},2000)
}}function N(P){L={uri:P.data.uri,title:P.data.title};
F={uri:P.data.uri,type:"graph"};
K()
}function E(P){$(".concept_"+F.uri.md5()).each(function(){F=P;
$(this).removeClass("activeNode");
var R=$(this).parent();
R.get(0).data.children.value="true";
var Q=J(R.get(0).data,R.get(0).datatype);
if(R.hasClass("last")){Q.addClass("last")
}R.replaceWith(Q);
((Q.children()).first()).click()
});
b.fire(new z(y.CONCEPT.SELECTED,F,B))
}function K(){var Q=$("<li style='padding-left: 0'></li>").append("<a class='graph_leaf'>&nbsp;</a>").append($("<a></a>").text(L.title).addClass("graph").attr("draggable",false).addClass("concept_"+L.uri.md5()).addClass("node").click(function(){$(".activeNode").removeClass("activeNode");
$(this).addClass("activeNode");
I(L.uri,"graph")
}));
var P=$("<ul></ul>");
r.list.schemes(L.uri,function(S){for(var R=0;
R<S.length;
R++){P.append(J(S[R],"scheme"))
}P.children().last().addClass("last");
$(".concept_"+F.uri.md5()).first().click()
},function(){l.alert("Alert","could not load schemes")
});
Q.append(P);
O.empty().append(Q).append(M());
O.children().last().addClass("last")
}function M(){var P=$("<li style='padding-left: 0'></li>").append("<a class='free_concept_leaf'>&nbsp;</a>").append($("<a></a>").text("Free Concepts").addClass("free").attr("draggable",false).addClass("node"));
H=$("<ul></ul>");
P.append(H);
G();
return P
}function G(){r.list.freeConcepts(L.uri,function(Q){H.empty();
for(var P=0;
P<Q.length;
P++){H.append(J(Q[P],"concept"))
}H.children().last().addClass("last")
},function(){l.alert("Alert","could not load free concepts")
})
}function A(P){$(".concept_"+P.md5()).each(function(){var S=$(this).attr("type");
var R=$(this).parent();
if(S=="scheme"){r.get.scheme(L.uri,P,function(T){Q(T,S,R)
},function(){l.alert("Alert","could not reload scheme")
})
}else{r.get.concept(L.uri,P,function(T){Q(T,S,R)
},function(){l.alert("Alert","could not reload concept")
})
}});
function Q(U,T,S){U[0].uri={value:P};
var R=J(U[0],T,S.attr("closed")=="false");
S.replaceWith(R);
(R.parent()).children().last().addClass("last")
}}function J(R,W,T){var Z=R.title?R.title.value:R.uri.value;
var Q=$("<a>&nbsp;</a>");
var U=$("<a></a>").text(Z).addClass(W).attr("type",W).addClass("concept_"+R.uri.value.md5()).addClass("node").click(function(){$(".activeNode").removeClass("activeNode");
$(".concept_"+R.uri.value.md5()).addClass("activeNode").focus();
I(R.uri.value,W)
});
if(R.uri.value==F.uri){U.addClass("activeNode")
}var S=$("<li></li>").attr("closed","true").append(Q).append(U);
S[0].data=R;
S[0].datatype=W;
var P=$("<ul></ul>");
var Y=R.uri.value;
var V=W=="scheme"?r.list.top_concepts:r.list.narrower;
var X=W=="scheme"?"top-concept":"concept";
if(R.children.value.bool()){Q.addClass("plus");
Q.click(function(){if(Q.hasClass("plus")){Q.removeClass("plus").addClass("loading");
V(L.uri,R.uri.value,function(ab){for(var aa=0;
aa<ab.length;
aa++){P.append(J(ab[aa],X))
}P.children().last().addClass("last");
Q.removeClass("loading").addClass("minus");
S.attr("closed","false")
},function(){l.alert("Alert","could not load children")
})
}else{if(Q.hasClass("minus")){P.empty();
Q.removeClass("minus").addClass("plus");
S.attr("closed","true")
}}});
Q.get(0).addEventListener("dragover",function(aa){if($(this).hasClass("plus")){$(this).click()
}},false)
}else{Q.addClass("leaf")
}if(W!="scheme"){U.attr("draggable",true);
U.addClass("draggable")
}U.get(0).addEventListener("dragstart",function(aa){b.fire(new z(y.CONCEPT.DRAGSTART));
this.style.opacity="0.4";
aa.dataTransfer.setData("text/uri-list",R.uri.value)
},false);
U.get(0).addEventListener("dragenter",function(aa){$(this).addClass("dragover")
},false);
U.get(0).addEventListener("dragover",function(aa){if(aa.preventDefault){aa.preventDefault()
}return false
},false);
U.get(0).addEventListener("dragleave",function(aa){$(this).removeClass("dragover")
},false);
U.get(0).addEventListener("drop",function(ab){if(ab.stopPropagation){ab.stopPropagation()
}var aa=ab.dataTransfer.getData("text/uri-list");
ab.preventDefault();
if(ab.dataTransfer.getData("text/plain")){l.info("Not Allowed","This kind of drop is not allowed");
return false
}if(aa==R.uri.value){if(!confirm("Make concept child of itself?")){return false
}}if(!aa||aa==""){l.info("Not Allowed","This kind of drop is not allowed");
return false
}if(W=="scheme"){r.set.topConcept(L.uri,R.uri.value,aa,function(){b.fire(new z(y.RELATION.CREATED,{type:"topConcept",parent:R.uri.value,child:aa},B));
b.fire(new z(y.CONCEPT.UPDATED,{uris:[R.uri.value,aa]}))
},function(){l.alert("Alert","could not add narrower")
})
}else{r.set.broaderNarrower(L.uri,R.uri.value,aa,function(){b.fire(new z(y.RELATION.CREATED,{type:"broaderNarrower",broader:R.uri.value,narrower:aa},B));
b.fire(new z(y.CONCEPT.UPDATED,{uris:[R.uri.value,aa]}))
},function(){l.alert("Alert","could not add narrower")
})
}return false
},false);
U.get(0).addEventListener("dragend",function(aa){b.fire(new z(y.CONCEPT.DRAGEND));
$(".dragover").removeClass("dragover");
$(".draggable").css("opacity",1)
},false);
S.append(P);
if(T){Q.click()
}return S
}function I(Q,P){F={uri:Q,type:P};
b.fire(new z(y.CONCEPT.SELECTED,F,B))
}}function m(C){var L;
var A=this;
b.bind(y.GRAPH.LOAD,function(M){L=M.data.uri;
$("#search_input").val("")
});
var J=3;
var H=5;
var I=false;
var K=new B();
$("#"+C).html(HTML_TEMPLATES.search);
var E;
var D=$("#search_input");
var G=$("#search_suggestion");
$("#search_div").focusout(function(){G.hide()
});
function F(){$(window).keydown(function(M){if(M.ctrlKey){switch(M.which){case 70:D.val("").focus();
break
}}})
}F();
D.keyup(function(N){if(L==null){D.val("");
l.info("Info","select a graph first")
}var O=D.val();
if(O.length>=J){if(N.keyCode==13){if(E){b.fire(new z(y.CONCEPT.SELECTED,E,A));
G.hide();
D.focusout()
}else{l.info("Info","no results")
}return
}if(N.keyCode==38){E={type:"concept"};
N.preventDefault();
var M=false;
G.children().each(function(){if($(this).hasClass("current")){M=true;
$(this).removeClass("current");
var P=$(this).prev();
if(P.length!=0){P.addClass("current");
E.uri=P.attr("uri");
E.title=P.attr("name")
}else{M=false
}return false
}});
if(!M){G.children().last().addClass("current");
E.uri=G.children().last().attr("uri");
E.title=G.children().last().attr("name")
}return false
}if(N.keyCode==40){E={type:"concept"};
N.preventDefault();
var M=false;
G.children().each(function(){if($(this).hasClass("current")){M=true;
$(this).removeClass("current");
var P=$(this).next();
if(P.length!=0){P.addClass("current");
E.uri=P.attr("uri");
E.title=P.attr("name")
}else{M=false
}return false
}});
if(!M){G.children().first().addClass("current");
E.uri=G.children().first().attr("uri");
E.title=G.children().first().attr("name")
}return false
}K.set();
r.search.suggestion(L,O,H,I,function(T){G.empty();
E=undefined;
if(T.length==0){G.append("<span class='empty'>no results</span>")
}for(var Q=0;
Q<T.length;
Q++){var S=new RegExp("("+O+")","gi");
var P=T[Q].text.value.replace(S,"<span>$1</span>");
var R=T[Q].scheme?(" ("+T[Q].scheme.value+")"):"";
G.append("<div name='"+T[Q].text.value+"' uri='"+T[Q].uri.value+"'>"+P+R+"</div>");
if(Q==0){(G.children()).first().addClass("current");
E={uri:T[Q].uri.value,title:T[Q].text.value,type:"concept"}
}}G.show();
K.remove()
},function(){l.alert("Alert","could not return suggestions")
})
}else{G.hide()
}});
function B(){var M=0;
this.set=function(){if(M==0){$("#search_loader").show()
}M++
};
this.remove=function(){M--;
if(M==0){$("#search_loader").hide()
}}
}this.init=function(){}
}function d(N){var E;
var P;
var Q=this;
var I;
b.bind(y.CONCEPT.SELECTED,function(V){P=V.data;
S(V.data.uri,V.data.type)
});
b.bind(y.GRAPH.LOAD,function(V){E=V.data.uri
});
b.bind(y.VIEW.RELOAD,function(Y){for(var W in Y.data.uris){var X=Y.data.uris[W];
for(var V in I){if(I[V].getProperty()==X){I[V].reload();
console.info(X)
}}}});
this.init=function(){};
var H=HTML_TEMPLATES.views.resource.literal.view;
var T=HTML_TEMPLATES.views.resource.literal.fix;
var K=HTML_TEMPLATES.views.resource.literal.edit;
var B=HTML_TEMPLATES.views.resource.add;
var A=HTML_TEMPLATES.views.resource.text.view;
var C=HTML_TEMPLATES.views.resource.text.fix;
var F=HTML_TEMPLATES.views.resource.text.edit;
var L=HTML_TEMPLATES.views.resource.concept.fix;
var J=HTML_TEMPLATES.views.resource.concept.edit;
function S(X,V){var W=$("<div></div>");
$("#"+N).empty().append(W);
b.unbind("property-view");
W.html(HTML_TEMPLATES.views.resource.basic);
$("#view_header_uri").text(X);
$("#view_content").addClass(V);
$("#view_header_rdf_link").click(function(){t.RDF_LINK(X)
});
$("#view_header_uri_delete").click(function(){b.fire(new z(y.CONCEPT.DELETE,P,self))
});
switch(V){case"graph":I=R(o.graph);
break;
case"scheme":I=R(o.scheme);
break;
default:I=R(o.concept);
var Y=$("#view_header_rdf_link").closest(".draghandle");
Y.attr("draggable",true).addClass("draggable");
Y.get(0).addEventListener("dragstart",function(Z){b.fire(new z(y.CONCEPT.DRAGSTART));
this.style.opacity="0.4";
Z.dataTransfer.setData("text/uri-list",X)
},false);
Y.get(0).addEventListener("dragend",function(Z){b.fire(new z(y.CONCEPT.DRAGEND));
$(".dragover").removeClass("dragover");
$(".draggable").css("opacity",1)
},false);
break
}}function R(X){var W=[];
for(var Y=0;
Y<X.left.length;
Y++){var V=O(X.left[Y]);
$("#view_content_left").append(V.getBox());
D(V);
W.push(V)
}for(var Y=0;
Y<X.right.length;
Y++){var V=O(X.right[Y]);
$("#view_content_right").append(V.getBox());
D(V);
W.push(V)
}return W
}function D(V){switch(V.getType()){case"string":switch(V.getProperty()){case"http://purl.org/dc/terms/modified":b.bind(y.PROPERTY.UPDATED,function(W){if(W.data.uri==P.uri){V.reload()
}},"property-view");
b.bind(y.PROPERTY.DELETED,function(W){if(W.data.uri==P.uri){V.reload()
}},"property-view");
b.bind(y.PROPERTY.CREATED,function(W){if(W.data.uri==P.uri){V.reload()
}},"property-view");
b.bind(y.RELATION.CREATED,function(W){switch(W.data.type){case"broader":if(W.data.narrower==P.uri){V.reload()
}break;
case"narrower":if(W.data.broader==P.uri){V.reload()
}break;
case"broaderNarrower":if(W.data.broader==P.uri||W.data.narrower==P.uri){V.reload()
}break;
case"topConcept":if(W.data.parent==P.uri){V.reload()
}break;
default:if(W.data.concept1=P.uri){V.reload()
}}},"property-view");
b.bind(y.RELATION.DELETED,function(W){switch(W.data.type){case"broader":if(W.data.narrower==P.uri){V.reload()
}break;
case"narrower":if(W.data.broader==P.uri){V.reload()
}break;
case"topConcept":if(W.data.parent==P.uri){V.reload()
}break;
default:if(W.data.concept1=P.uri){V.reload()
}}},"property-view");
break
}break;
case"concept":switch(V.getProperty()){case"http://www.w3.org/2004/02/skos/core#broader":case"http://www.w3.org/2004/02/skos/core#narrower":case"http://www.w3.org/2004/02/skos/core#hasTopConcept":b.bind(y.RELATION.DELETED,function(W){switch(W.data.type){case"broader":if(W.data.narrower==P.uri){V.reload()
}break;
case"narrower":if(W.data.broader==P.uri){V.reload()
}break;
case"topConcept":if(W.data.parent==P.uri){V.reload()
}break
}},"property-view");
b.bind(y.RELATION.CREATED,function(W){switch(W.data.type){case"broader":if(W.data.narrower==P.uri){V.reload()
}break;
case"narrower":if(W.data.broader==P.uri){V.reload()
}break;
case"broaderNarrower":if(W.data.broader==P.uri||W.data.narrower==P.uri){V.reload()
}break;
case"topConcept":if(W.data.parent==P.uri){V.reload()
}break
}},"property-view");
break
}break
}}function O(V){switch(V.type){case"string":return new G(V.title,V.property,V.multilingual,V.multivalue,V.editable,false);
case"text":return new G(V.title,V.property,V.multilingual,V.multivalue,V.editable,true);
case"uri":return new M(V.title,V.property,V.multivalue,V.editable);
case"concept":return new U(V.title,V.property,V.droppable,V.editable)
}}function G(Z,ab,ac,ad,W,X){var Y=$("<div></div>").addClass("content_box").append($("<h1></h1>").text(Z));
var V=$("<div></div>").appendTo(Y);
aa();
this.getBox=function(){return Y
};
this.getType=function(){return"string"
};
this.getProperty=function(){return ab
};
this.reload=function(){aa()
};
function aa(){r.list.values(E,P.uri,ab,ae,function(){l.alert("Alert","could not list values "+ab)
})
}function ae(ai){V.empty();
var ak={};
for(var af=0;
af<ai.length;
af++){if(ai[af].value["xml:lang"]){if(!ak[ai[af].value["xml:lang"]]){ak[ai[af].value["xml:lang"]]=[]
}ak[ai[af].value["xml:lang"]].push(ai[af].value.value)
}else{if(!ak.none){ak.none=[]
}ak.none.push(ai[af].value.value)
}}var aj=X?"view_subbox_text":"view_subbox";
if(ac){for(var af=0;
af<v.getLanguages().length;
af++){var ag=$("<div></div>").addClass("list_values");
ag.appendTo(V);
ag.append($("<div></div>").addClass("language_sign").append("<span>"+v.getLanguages()[af]+"</span>"));
ag.append($("<div></div>").addClass(aj).append(ah(ak[v.getLanguages()[af]],v.getLanguages()[af])))
}}else{var ag=$("<div></div>").addClass("list_values");
ag.appendTo(V);
ag.append($("<div></div>").addClass(aj).append(ah(ak.none,null)))
}function ah(ao,ar){var an=$("<table></table>").addClass("literal_table");
function aq(aw){if(W){var au=X?$(A):$(H);
var at=X?$(F):$(K);
at.find(".literal_input").val(aw);
au.find(".literal_text").html(aw.n3escapeToHMTL());
au.find(".literal_text").attr("original",aw);
au.find(".literal_text").click(function(){au.hide();
at.show();
at.find(".literal_input").focus()
});
au.find(".literal_edit").click(function(){au.hide();
at.show();
at.find(".literal_input").focus()
});
at.find(".literal_save").click(function(){var ay=at.find(".literal_input").val().n3escape();
var ax=at.find(".literal_input").val().n3escapeToHMTL();
r.update.value(E,P.uri,ab,au.find(".literal_text").attr("original").n3escape(),ay,ar,function(){b.fire(new z(y.PROPERTY.UPDATED,{uri:P.uri,property:ab,language:ar,value:ay},Q));
b.fire(new z(y.CONCEPT.UPDATED,{uris:[P.uri]}));
au.find(".literal_text").html(ax);
au.find(".literal_text").attr("original",ay);
at.hide();
au.show()
})
});
at.find(".literal_cancel").click(function(){at.hide();
at.find(".literal_input").val(au.find(".literal_text").attr("original"));
au.show()
});
au.find(".literal_delete").click(function(){if(confirm("delete property?")){r._delete.value(E,P.uri,ab,au.find(".literal_text").attr("original").n3escape(),ar,function(){b.fire(new z(y.PROPERTY.DELETED,{uri:P.uri,property:ab,language:ar},Q));
b.fire(new z(y.CONCEPT.UPDATED,{uris:[P.uri]}));
aa()
})
}});
an.append(au);
an.append(at)
}else{var av=X?$(C):$(T);
av.find(".literal_text").text(aw);
an.append(av)
}}function am(){var at=$(B);
at.find(".add").click(function(){var av=ar?("("+ar+")"):"";
var au=prompt("Set value for '"+Z+"' "+av,"");
if(au!=null){if(au==""){l.alert("Alert","value must not be empty")
}else{r.set.value(E,P.uri,ab,au,ar,function(){b.fire(new z(y.PROPERTY.CREATED,{uri:P.uri,property:ab,language:ar,value:au},Q));
b.fire(new z(y.CONCEPT.UPDATED,{uris:[P.uri]}));
aa()
})
}}});
an.append(at)
}function ap(){var at=$(T);
at.find(".literal_text").text("N/A");
an.append(at)
}if(ao){for(var al=0;
al<ao.length;
al++){aq(ao[al])
}if(ad&&W){am()
}}else{if(W){am()
}else{ap()
}}return an
}}return this
}function M(aa,ab,ad,X){var Z=$("<div></div>").addClass("content_box").append($("<h1></h1>").text(aa));
var V=$("<div></div>").appendTo(Z);
ac();
this.getBox=function(){return Z
};
this.getType=function(){return"uri"
};
this.getProperty=function(){return ab
};
this.reload=function(){ac()
};
function ac(){r.list.values(E,P.uri,ab,ae,function(){l.alert("Alert","could not list values "+ab)
})
}function Y(ah,ai){var ag=$(H);
var af=$(K);
af.find(".literal_input").val(ai.value.value);
ag.find(".literal_text").text(ai.value.value);
ag.find(".literal_text").click(function(){ag.hide();
af.show();
af.find(".literal_input").focus()
});
ag.find(".literal_edit").click(function(){ag.hide();
af.show();
af.find(".literal_input").focus()
});
af.find(".literal_save").click(function(){var ak=ag.find(".literal_text").text();
var aj=af.find(".literal_input").val();
if(W(aj)){r.update.uri(E,P.uri,ab,ak,aj,function(){b.fire(new z(y.PROPERTY.UPDATED,{uri:P.uri,property:ab,value:aj},Q));
b.fire(new z(y.CONCEPT.UPDATED,{uris:[P.uri]}));
ag.find(".literal_text").text(aj);
af.hide();
ag.show()
})
}else{l.alert("Alert",aj+" is not a valid url")
}});
af.find(".literal_cancel").click(function(){af.hide();
af.find(".literal_input").val(ag.find(".literal_text").text());
ag.show()
});
ag.find(".literal_delete").click(function(){if(confirm("delete property?")){r._delete.uri(E,P.uri,ab,ag.find(".literal_text").text(),function(){b.fire(new z(y.PROPERTY.DELETED,{uri:P.uri,property:ab},Q));
b.fire(new z(y.CONCEPT.UPDATED,{uris:[P.uri]}));
ac()
})
}});
ah.append(ag);
ah.append(af)
}function ae(ak){var aj=$("<table></table>").addClass("literal_table");
var al=$("<div></div>").addClass("view_subbox").append(aj);
var ai=$("<div></div>").addClass("list_values").append(al);
V.empty().append(ai);
if(ak&&ak.length>0){if(X){for(var ag=0;
ag<ak.length;
ag++){Y(aj,ak[ag])
}if(ad){af()
}}else{for(var ag=0;
ag<ak.length;
ag++){var ah=$(T);
ah.find(".literal_text").text(ak[ag].value.value);
aj.append(ah)
}}}else{if(X){af()
}else{var ah=$(T);
ah.find(".literal_text").text("N/A");
aj.append(ah)
}}function af(){var am=$(B);
am.find(".add").click(function(){var an=prompt("Set value for '"+aa+"'");
if(an!=null){if(an==""){l.alert("Alert","value must not be empty")
}else{if(W(an)){r.set.uri(E,P.uri,ab,an,function(){b.fire(new z(y.PROPERTY.CREATED,{uri:P.uri,property:ab,value:an},Q));
b.fire(new z(y.CONCEPT.UPDATED,{uris:[P.uri]}));
ac()
})
}else{l.alert("Alert",an+" is not a valid url")
}}}});
aj.append(am)
}}function W(ag){var af=new RegExp("^(http|https|ftp)://([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&amp;%$-]+)*@)*((25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])|([a-zA-Z0-9-]+.)*[a-zA-Z0-9-]+.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(/($|[a-zA-Z0-9.,?'\\+&amp;%$#=~_-]+))*$");
return af.test(ag)
}return this
}function U(aa,ab,Z,X){var Y=$("<div></div>").addClass("content_box").append($("<h1></h1>").text(aa));
var W=$("<div></div>").appendTo(Y);
ac();
this.getBox=function(){return Y
};
this.getType=function(){return"concept"
};
this.getProperty=function(){return ab
};
this.reload=function(){ac()
};
function ac(){r.list.concepts(E,P.uri,ab,ad,function(){l.alert("Alert","could not list values "+ab)
})
}function V(af,ag){var ah=ag.title?ag.title.value:ag.uri.value;
if(X){var ae=$(J);
var ai=ae.find(".concept_text");
ai.text(ah).click(function(){b.fire(new z(y.CONCEPT.SELECTED,{uri:ag.uri.value,type:"concept"},Q))
});
ai.attr("draggable",true).addClass("draggable");
ai.get(0).addEventListener("dragstart",function(aj){b.fire(new z(y.CONCEPT.DRAGSTART));
this.style.opacity="0.4";
aj.dataTransfer.setData("text/uri-list",ag.uri.value)
},false);
ai.get(0).addEventListener("dragend",function(aj){b.fire(new z(y.CONCEPT.DRAGEND));
$(".dragover").removeClass("dragover");
$(".draggable").css("opacity",1)
},false);
af.append(ae);
ae.find(".concept_delete").click(function(){if(!confirm("delete relation")){return false
}if(ab=="http://www.w3.org/2004/02/skos/core#broader"){r._delete.broaderNarrower(E,ag.uri.value,P.uri,function(){b.fire(new z(y.RELATION.DELETED,{type:"broader",narrower:P.uri,broader:ag.uri.value},Q));
b.fire(new z(y.CONCEPT.UPDATED,{uris:[P.uri,ag.uri.value]}))
},function(){l.alert("Alert","could not delete relation")
})
}else{if(ab=="http://www.w3.org/2004/02/skos/core#narrower"){r._delete.broaderNarrower(E,P.uri,ag.uri.value,function(){b.fire(new z(y.RELATION.DELETED,{type:"narrower",narrower:ag.uri.value,broader:P.uri},Q));
b.fire(new z(y.CONCEPT.UPDATED,{uris:[P.uri,ag.uri.value]}))
},function(){l.alert("Alert","could not delete relation")
})
}else{if((ab=="http://www.w3.org/2004/02/skos/core#hasTopConcept")){r._delete.topConcept(E,P.uri,ag.uri.value,function(){b.fire(new z(y.RELATION.DELETED,{type:"topConcept",parent:P.uri,child:ag.uri.value},Q));
b.fire(new z(y.CONCEPT.UPDATED,{uris:[P.uri,ag.uri.value]}))
},function(){l.alert("Alert","could not delete relation")
})
}else{if((ab=="http://www.w3.org/2004/02/skos/core#related")){r._delete.related(E,P.uri,ag.uri.value,function(){b.fire(new z(y.RELATION.DELETED,{type:"related",concept1:P.uri,concept2:ag.uri.value},Q));
b.fire(new z(y.CONCEPT.UPDATED,{uris:[P.uri,ag.uri.value]}));
ac()
},function(){l.alert("Alert","could not delete relation")
})
}else{r._delete.uri(E,P.uri,ab,ag.uri.value,function(){b.fire(new z(y.RELATION.CREATED,{type:ab,concept1:P.uri,concept2:ag.uri.value},Q));
b.fire(new z(y.CONCEPT.UPDATED,{uris:[P.uri,ag.uri.value]}));
ac()
},function(){l.alert("Alert","could not create relation")
})
}}}}})
}else{var ae=$(L);
var ai=ae.find(".concept_text");
ai.text(ah).click(function(){b.fire(new z(y.CONCEPT.SELECT,P,Q))
});
ai.attr("draggable",true).addClass("draggable");
ai.get(0).addEventListener("dragstart",function(aj){b.fire(new z(y.CONCEPT.DRAGSTART));
this.style.opacity="0.4";
aj.dataTransfer.setData("text/uri-list",ag.uri.value)
},false);
ai.get(0).addEventListener("dragend",function(aj){b.fire(new z(y.CONCEPT.DRAGEND));
$(".dragover").removeClass("dragover");
$(".draggable").css("opacity",1)
},false);
af.append(ae)
}}function ad(ah){var ag=$("<table></table>").addClass("literal_table");
var ai=$("<div></div>").addClass("view_subbox").append(ag);
if(Z){$("<div><i class='icon-share-alt'></i></div>").addClass("droppable").appendTo(ai);
ai.addClass("view_uri_subbox")
}var af=$("<div></div>").addClass("list_values").append(ai);
W.empty().append(af);
if(ah&&ah.length>0){for(var ae=0;
ae<ah.length;
ae++){V(ag,ah[ae])
}}if(Z){ai.get(0).addEventListener("dragenter",function(aj){af.addClass("boxDragover")
},false);
ai.get(0).addEventListener("dragover",function(aj){if(aj.preventDefault){aj.preventDefault()
}return false
},false);
ai.get(0).addEventListener("dragleave",function(aj){af.removeClass("boxDragover")
},false);
ai.get(0).addEventListener("drop",function(al){if(al.stopPropagation){al.stopPropagation()
}var ak=al.dataTransfer.getData("text/uri-list");
al.preventDefault();
if(al.dataTransfer.getData("text/plain")){l.info("Not Allowed","This kind of drop is not allowed");
return false
}if(!ak||ak==""){l.info("Not Allowed","This kind of drop is not allowed");
return false
}var aj=al.dataTransfer.getData("parent");
if(ab=="http://www.w3.org/2004/02/skos/core#broader"){r.set.broaderNarrower(E,ak,P.uri,function(){b.fire(new z(y.RELATION.CREATED,{type:"broader",broader:ak,narrower:P.uri},Q));
b.fire(new z(y.CONCEPT.UPDATED,{uris:[P.uri,ah.uri]}))
},function(){l.alert("Alert","could not set relation")
})
}else{if(ab=="http://www.w3.org/2004/02/skos/core#narrower"){r.set.broaderNarrower(E,P.uri,ak,function(){b.fire(new z(y.RELATION.CREATED,{type:"narrower",narrower:ak,broader:P.uri},Q));
b.fire(new z(y.CONCEPT.UPDATED,{uris:[P.uri,ah.uri]}))
},function(){l.alert("Alert","could not set relation")
})
}else{if((ab=="http://www.w3.org/2004/02/skos/core#hasTopConcept")){r.set.topConcept(E,P.uri,ak,function(){b.fire(new z(y.RELATION.CREATED,{type:"topConcept",parent:P.uri,child:ak},Q));
b.fire(new z(y.CONCEPT.UPDATED,{uris:[P.uri,ah.uri]}))
},function(){l.alert("Alert","could not set relation")
})
}else{if((ab=="http://www.w3.org/2004/02/skos/core#related")){r.set.related(E,P.uri,ak,function(){b.fire(new z(y.RELATION.CREATED,{type:"related",concept1:P.uri,concept2:ak},Q));
b.fire(new z(y.CONCEPT.UPDATED,{uris:[P.uri,ah.uri]}));
ac()
},function(){l.alert("Alert","could not create relation")
})
}else{r.set.uri(E,P.uri,ab,ak,function(){b.fire(new z(y.RELATION.CREATED,{type:ab,concept1:P.uri,concept2:ak},Q));
b.fire(new z(y.CONCEPT.UPDATED,{uris:[P.uri,ah.uri]}));
ac()
},function(){l.alert("Alert","could not create relation")
})
}}}}af.removeClass("boxDragover");
return false
},false)
}}return this
}}function g(B,A){var J;
var L=this;
b.bind(y.GRAPH.CREATE,function(){new C()
});
b.bind(y.CONCEPT.CREATE,function(M){new E(M.data)
});
b.bind(y.SETTINGS.UPDATE,function(){new D()
});
b.bind(y.GRAPH.SELECTED,function(M){J=M.data.uri
});
b.bind(y.CONCEPT.DELETE,function(Q){var P=function(){r._delete.graph()
};
var S=function(){alert("Not implemented yet");
K()
};
var O=function(){r.list.incomings(J,Q.data.uri,function(T){r._delete.concept(J,Q.data.uri,function(){b.fire(new z(y.GRAPH.SELECTED,{uri:J},L));
var V=[];
for(var U in T){if(T[U].uri.value!=Q.data.uri){V.push(T[U].uri.value)
}}b.fire(new z(y.CONCEPT.UPDATED,{uris:V}));
b.fire(new z(y.SCHEME.DELETED,{uri:Q.data.uri}));
K()
},function(){l.alert("Alert","Could not delete scheme!")
})
},function(){l.alert("Alert","Could not delete scheme!")
})
};
var M=function(){r.list.incomings(J,Q.data.uri,function(T){r._delete.concept(J,Q.data.uri,function(){b.fire(new z(y.GRAPH.SELECTED,{uri:J},L));
var V=[];
for(var U in T){if(T[U].uri.value!=Q.data.uri){V.push(T[U].uri.value)
}}b.fire(new z(y.CONCEPT.UPDATED,{uris:V}));
b.fire(new z(y.CONCEPT.DELETED,{uri:Q.data.uri}));
K()
},function(){l.alert("Alert","Could not delete scheme!")
})
},function(){l.alert("Alert","Could not delete scheme!")
})
};
var R=function(){r.list.incomings(J,Q.data.uri,function(T){r._delete.skosRelations(J,Q.data.uri,function(){b.fire(new z(y.GRAPH.SELECTED,{uri:J},L));
var V=[];
for(var U in T){if(T[U].uri.value!=Q.data.uri){V.push(T[U].uri.value)
}}V.push(Q.data.uri);
b.fire(new z(y.CONCEPT.UPDATED,{uris:V}));
K()
},function(){l.alert("Alert","Could not delete scheme!")
})
},function(){l.alert("Alert","Could not delete scheme!")
})
};
switch(Q.data.type){case"graph":new H("Delete Graph","Deleting graph will delete all underlying schemes and concepts!",[{title:"Delete Graph",action:P}]);
break;
case"scheme":new H("Delete Scheme","Delete scheme and all concepts or delete the scheme only?",[{title:"Delete all",action:S},{title:"Delete scheme only",action:O}]);
break;
default:new H("Delete Concept","Delete concept with all properties or just remove concept from SKOS Tree?",[{title:"Delete Concept",action:M},{title:"Remove Concept",action:R}])
}function N(){}});
this.init=function(){};
this.alert=function(N,M){new F(N,M)
};
this.info=function(N,M){new G(N,M)
};
this.custom=function(M){return new I(M)
};
function H(R,Q,P){$("#"+A).show();
$("#"+B).html(HTML_TEMPLATES.popups.confirm);
$("#popup_title").text(R);
$("#popup_message").html(Q);
$("#popup_close").click(function(){K()
});
$("#popup_cancel").click(function(){K()
});
var O=$("#popup_button_list");
for(var N in P){var M=S(P[N]);
M.appendTo(O)
}$("#popup_cancel").focus();
function S(U){var T=$("<button></button>").text(U.title).click(function(){U.action()
});
return T
}}function I(N){var M=this;
$("#popup").html(HTML_TEMPLATES.popups.custom);
$("#popup_title").text(N);
$("#popup_close").click(function(){M.close()
});
this.open=function(){$("#"+A).show();
$("#popup_custom").show()
};
this.setContent=function(O){$("#popup_content").html(O)
};
this.close=function(){K()
}
}function F(O,M,N){$("#"+A).show();
$("#"+B).html(HTML_TEMPLATES.popups.alert);
$("#popup_title").text(O);
$("#popup_message").html(M);
$("#popup_close").click(function(){K();
if(N){N()
}});
$("#popup_cancel").click(function(){K();
if(N){N()
}});
$("#popup_cancel").focus()
}function G(O,M,N){$("#"+A).show();
$("#"+B).html(HTML_TEMPLATES.popups.info);
$("#popup_title").text(O);
$("#popup_message").html(M);
$("#popup_close").click(function(){K();
if(N){N()
}});
$("#popup_cancel").click(function(){K();
if(N){N()
}});
$("#popup_cancel").focus()
}function E(P){$("#"+A).show();
$("#"+B).html(HTML_TEMPLATES.popups.concept);
$("#popup_title").text("Create "+Q(P.type));
$("#popup_close").click(function(){K()
});
$("#popup_create").click(function(){if($("#popup_input").val()==""){l.info("Info","name is mandatory")
}else{var R=t.BASE_URI+String.random(8);
var S=$("#popup_input").val();
switch(P.type){case"graph":M(R,S);
break;
case"scheme":N(P.uri,R,S);
break;
default:O(P.uri,R,S);
break
}}});
$("#popup_input").focus();
$("#popup_input").keydown(function(R){if(R.which==13){$("#popup_create").click();
return false
}});
function M(R,S){r.create.scheme(J,R,S,function(){b.fire(new z(y.SCHEME.CREATED,{parent:J,uri:R,type:"scheme"}));
b.fire(new z(y.GRAPH.UPDATED,{uris:[J]}));
K()
},function(){l.alert("Alert","could not create concept",K)
})
}function N(R,S,T){r.create.top_concept(J,R,S,T,function(){b.fire(new z(y.CONCEPT.CREATED,{parent:R,uri:S,type:"top-concept"}));
b.fire(new z(y.SCHEME.UPDATED,{uris:[R]}));
K()
},function(){l.alert("Alert","could not create concept",K)
})
}function O(R,S,T){r.create.concept(J,R,S,T,function(){b.fire(new z(y.CONCEPT.CREATED,{parent:R,uri:S,type:"concept"}));
b.fire(new z(y.CONCEPT.UPDATED,{uris:[R]}));
K()
},function(){l.alert("Alert","could not create concept",K)
})
}function Q(R){switch(R){case"graph":return"scheme";
case"scheme":return"top-concept";
default:return"concept"
}}}function C(){$("#"+A).show();
$("#"+B).html(HTML_TEMPLATES.popups.graph);
$("#popup_close").click(function(){K()
});
$("#popup_create").click(function(){if($("#popup_input").val()==""){l.info("Info","name is mandatory")
}else{var M=t.BASE_URI+String.random(8);
var N=$("#popup_input").val();
r.create.graph(M,N,function(){b.fire(new z(y.GRAPH.CREATED,{uri:M}));
b.fire(new z(y.GRAPH.SELECTED,{uri:M}));
K()
},function(){l.alert("Alert","could not create graph",K)
})
}});
$("#popup_input").focus();
$("#popup_input").keydown(function(M){if(M.which==13){$("#popup_create").click();
return false
}});
r.list.graphs(function(O){$("#popup_loading").hide();
function N(Q){var R=(Q.title)?Q.title.value:Q.uri.value;
var P=$("<button></button>").text(R).click(function(){b.fire(new z(y.GRAPH.SELECTED,{uri:Q.uri.value}));
K()
});
$("#popup_list").append($("<li></li>").append(P))
}for(var M=0;
M<O.length;
M++){N(O[M])
}if(O.length==0){$("#popup_list").hide();
$("#popup_empty_list").show()
}},function(){l.alert("Alert","could not list graphs",K)
})
}function D(){var P=false;
var R;
$("#"+A).show();
$("#"+B).html(HTML_TEMPLATES.popups.settings);
$(".popup_cancel").click(function(){clearTimeout(R);
K();
if(P){b.fire(new z(y.SETTINGS.UPDATED))
}});
S();
function S(){$("#settings_language_firstLanguageSelect").change(function(){N($("#settings_language_firstLanguageSelect").val())
});
$("#settings_language_newLanguageButton").click(function(){var U=$("#settings_language_newLanguageInput").val();
if(U==""){T("language may not be empty")
}else{M(U)
}});
Q()
}function Q(){var X=v.getLanguage();
var W=v.getLanguages();
function V(Z){var Y=$("<li><span>"+Z+"</span></li>").append($("<button class='button'></button>").html("<i class='icon-minus'></i>").click(function(){O(Z)
}));
return Y
}$("#settings_language_list").empty();
for(var U in W){$("#settings_language_list").append(V(W[U]))
}$("#settings_language_firstLanguageSelect").empty();
for(var U in W){if(X==W[U]){$("#settings_language_firstLanguageSelect").append("<option selected='selected'>"+W[U]+"</option>")
}else{$("#settings_language_firstLanguageSelect").append("<option>"+W[U]+"</option>")
}}}function O(W){if(v.getLanguages().length==1){T("graph must support at least one language");
return
}if(W==v.getLanguage()){T("first language cannot be deleted");
return
}var V=v.getLanguages();
var U=[];
for(i in V){if(V[i]!=W){U.push(V[i])
}}r.set.graphLanguages(J,U,function(){b.fire(new z(y.GRAPH.UPDATED,{uris:[J]}));
v.setLanguages(U);
P=true;
Q()
},function(){alert("could not set languages")
})
}function N(U){r.set.graphFirstLanguage(J,U,function(){b.fire(new z(y.GRAPH.UPDATED,{uris:[J]}));
P=true
},function(){alert("could not set language")
})
}function M(V){var U=v.getLanguages();
for(i in U){if(U[i]==V){return
}}U.push(V);
r.set.graphLanguages(J,U,function(){b.fire(new z(y.GRAPH.UPDATED,{uris:[J]}));
v.setLanguages(U);
P=true;
Q()
},function(){alert("could not set languages")
})
}function T(U){$("#settings_language_info").text(U);
R=setTimeout(function(){$("#settings_language_info").empty()
},2000)
}}function K(){$("#"+B).empty();
$("#"+A).hide()
}}function h(){var D=50;
var H;
var C;
var G=false;
var F=undefined;
b.bind(y.CONCEPT.DRAGSTART,function(I){E()
});
b.bind(y.CONCEPT.DRAGEND,function(I){G=false;
F=undefined;
B()
});
function E(){C=$("<div style='height:20px;width:100%;position:fixed;50%;z-index:1001;top:0;display:none'></div>").appendTo("body");
C.get(0).addEventListener("dragenter",function(){G=true;
F="top";
A()
});
C.get(0).addEventListener("dragleave",function(){G=false;
F=undefined
});
H=$("<div style='height:20px;width:100%;position:fixed;z-index:1001;bottom:0;display: none'></div>").appendTo("body");
H.get(0).addEventListener("dragenter",function(){G=true;
F="bottom";
A()
});
H.get(0).addEventListener("dragleave",function(){G=false;
F=undefined
});
if($(window).scrollTop()>0){C.show()
}if($(document).height()>($(window).height()+$(window).scrollTop()+1)){H.show()
}}function B(){H.remove();
C.remove()
}function A(){if(!G){return
}if(F=="top"){$(window).scrollTop($(window).scrollTop()-D);
if($(document).height()>($(window).height()+$(window).scrollTop())){H.show()
}if($(window).scrollTop()==0){C.hide()
}else{setTimeout(A,50)
}}else{$(window).scrollTop($(window).scrollTop()+D);
if($(window).scrollTop()>0){C.show()
}if($(document).height()==($(window).height()+$(window).scrollTop()+1)){H.hide()
}else{setTimeout(A,50)
}}}}}String.prototype.md5=function(){return hex_md5(this)
};
String.random=function(e){var d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";
var c="";
for(var b=0;
b<e;
b++){var a=Math.floor(Math.random()*d.length);
c+=d.substring(a,a+1)
}return c
};
String.prototype.bool=function(){return(/^true$/i).test(this)
};
String.prototype.n3escape=function(){console.log(1);
return this.replace(/(\r\n|\n|\r)/gm,"\\n")
};
String.prototype.n3escapeToHMTL=function(){return this.replace(/(\r\n|\n|\r)/gm,"<br/>")
};
